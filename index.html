
<!DOCTYPE html>
<!-- G√âN√âRATEUR D'ATTRIBUTION DE LICENCES CREATIVE COMMONS ET G√âN√âRATEUR DE CITATIONS APA
v 1,0 alpha
Copyright (C) 2026 Claude Potvin (https://www.linkedin.com/in/claude-potvin-b506a471/)
# Assistance √† la programmation r√©alis√©e avec un robot conversationnel (Microsoft Copilot).

Cette appli demande √† l'utilisateur de faire un choix selon 3 possibilit√©s selon que l'oeuvre est:
Originale : 1 onglet √† remplir
Adapt√©e (Nouvelle oeuvre d√©riv√©e) : 2 onglets √† remplir
Ajust√©e : 1 onglet √† remplir 

Onglet 1 : pas de num√©ro dans les variables (oeuvre cr√©√©e ou ajust√©e)
Onglet 2 : num√©ro 0 ajout√© dans les variables (oeuvre d'origine)

*******************************************************
LICENCE
Copyright (C) 2026 Claude Potvin (https://www.linkedin.com/in/claude-potvin-b506a471/)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program. If not, see &lt;https://www.gnu.org/licenses/&gt;.


Note pour les francophones : Pour des raisons l√©gales, cette licence n'est pour le moment disponible qu'en anglais.

***********************************************************
-->

<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Attribution d'une &#339;uvre ÔøΩ Saisie &amp; Sortie</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
 <style>
  :root { --border:#d0d7de; --muted:#555; --brand:#0078D7; }
  body { font-family: Arial, sans-serif; margin: 24px; line-height: 1.45; }

.highlight { background-color: yellow; }

.container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  position: relative;
  border-top: 2px solid #0078D7;
}

.container::before {
  content: "";
  position: absolute;
  top: 2px;   /* d√©marre sous la ligne horizontale */
  bottom: 0;
  left: 50%;
  border-left: 2px solid #0078D7;
}

.panel { border: 0px solid var(--border); padding: 0 18px; }

  h1 { font-size: 1.4rem; margin: 0 0 12px; }
  h2 { margin: 0 0 10px; font-size: 1.1rem; letter-spacing: 0.02em; }
  .title-out { margin-top: 6px; font-weight: bold; font-size: 1rem; display: none; }/* cach√© au d√©part */
  label { display:block; margin-top: 10px; font-weight: 600; }
  input[type="text"], input[type="url"], input[type="number"] {
    width: 80%; padding: 8px 10px; margin-top: 6px;
    border: 1px solid var(--border); border-radius: 6px;
  }

  .help { color: var(--muted); font-size: 0.9em; margin-top: 6px; }
  .out-line { margin-top: 8px; font-size: 1rem; }
  .out-subline { margin-top: 6px; font-size: 0.95em; color: var(--muted); }
  .out-subline a { color: var(--brand); word-break: break-all; }
  .license-line { margin-top: 4px; font-size: 0.95em; color: var(--muted); }
  .license-line a { color: var(--brand); }
  .quote { white-space: pre-wrap; }
  .separator { margin: 0 6px; color: #888; }

  /* ‚úÖ Bloc Type d‚Äô≈ìuvre */
    .bloc-type {
        background-color: #f0f0f0;
        padding: 10px 15px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        gap: 20px;
        font-family: sans-serif;
        justify-content: space-between; 
    }
        .bloc-type2 {
        background-color: #e0d9d9;
        padding: 10px 15px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        gap: 20px;
        font-family: sans-serif;
        justify-content: space-between; 

    }

  .radio-group {
    display: flex;
    gap: 20px;
  }

  /* ‚úÖ AJOUT : Styles pour les onglets */
  .tabs {
    border: 0px solid var(--border);
    border-radius: 8px;
    padding: 12px;
    /* border-top: 2px solid #0078D7;  */
  }

  .tab-buttons {
    display: flex;
    gap: 10px;
    margin-bottom: 12px;
    margin-top: 12px;
    margin-right: 12px;
  }

.tab-buttons button {
  padding: 6px 12px;
  border: 1px solid #0078D7;   /* contour bleu par d√©faut */
  background: #f7f7f7;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.95rem;
  color: #0078D7;              /* texte bleu pour coh√©rence */
}

.tab-buttons button.active-tab {
  background: var(--brand);
  color: white;
  border-color: var(--brand);  /* contour prend la couleur de la marque quand actif */
}
  .active-tab {
  background: var(--brand);
  color: white;
  border-color: var(--brand);
  font-weight: bold;
}
  .tab-content {
    border: 0px solid var(--border);
    background: #fafafa;
    padding: 12px;
    border-radius: 6px;
    display: none;
  }
  #boutons,#remplir, #generer {
  display: none; /* cach√© au d√©part */

 table { border-collapse: collapse; margin-bottom: 1em; width: 100%; }
  th, td { border: 1px solid #ccc; padding: 6px; text-align: center; table-layout: auto;}
  /*td input[type="text"] { width: 95%; max-width: 100%; box-sizing: border-box;  inclut padding/border dans la largeur */}
 td input[type="text"] {
  width: 100%;          /* occupe toute la cellule */
  max-width: 100%;      /* ne d√©passe jamais */
  box-sizing: border-box; /* inclut padding/border dans la largeur */
}
  td input[type="checkbox"] { display: block; margin: auto; }
  .add-row { font-size: 24px; font-weight: bold; cursor: pointer; color: green; }
  textarea { width: 100%; height: 60px; }
  .disabled { background-color: #eee; color: #666; }


/* td input[type="text"] {
  width: 100%;
  max-width: 100%;
  box-sizing: border-box; /* inclut padding/border dans la largeur */
 */

/*table {
 // table-layout: auto;  largeur dynamique pour les colonnes */


th, td {
  border: 1px solid #ccc;
  padding: 6px;
}

/* Les deux premi√®res colonnes s'√©tendent automatiquement */
td:nth-child(1),
td:nth-child(2),
th:nth-child(1),
th:nth-child(2) {
  width: auto;
}

/* Les deux derni√®res colonnes centr√©es */
td:nth-child(3),
td:nth-child(4),
th:nth-child(3),
th:nth-child(4) {
    text-align: center;
    width: 80px;   /* ou 60px selon ton go√ªt */
}



.affichageRez {display: none;} /* cach√© au d√©part */

.explication {
/*   grid-column: 2;   : place le bloc dans la colonne de droite */
  margin-left: auto;   /*  place le bloc dans la colonne de droite   */ 
  padding: 6px 12px; 
  background-color: #f9f9f4;      /* fond tr√®s clair */
  border: 1px solid #dcd7c9;      /* bordure douce */
  border-radius: 4px;
  font-weight: 540;               /* entre normal et bold */
  color: #020202;                 /* gris fonc√©, lisible mais pas agressif */
  max-width: 1000px;
}

.droite { display: flex; justify-content: flex-end; }
.bouton-grand { 
    font-size: 1.0rem; 
    font-weight: normal; 
    padding: 12px 24px; 
    border-radius: 6px; 
    background-color: #0078d4; 
    color: white; 
    border: none; 
    cursor: pointer; 
}

.bouton-moyen { 
    font-size: 1.0rem; 
    font-weight: normal; 
    padding: 12px 24px; 
    border-radius: 5px; 
    background-color: #0078d4; 
    color: white; 
    border: none; 
    cursor: pointer; 
    margin-left: auto;
    display: none;
}

 .bouton-grand:hover { background-color: #005fa3; }  
 #titre { width: auto; }
 /* .col2 { border-left: 2px solid #0078D7; padding-left: 16px; margin-left: 8px; } */
 /* .col1 { border-top: 2px solid #0078D7; // ligne en haut  */
    /* padding-left: 16px; margin-left: 8px; } */
  .col2 { /*border-left: 2px solid #0078D7;  ligne √† gauche */  
    /* border-top: 2px solid #0078D7; /* ligne en haut */  
     padding-left: 16px; margin-left: 16px; padding-top: 16px;} */
/* .bouton-grand { font-size: 1.2rem; font-weight: bold; padding: 10px 20px; } */

/* p { font-size: 1.5em; /* agrandit la police */  */

.disabled { background: #eee; }

  /* Animation subtile lors de l‚Äôajout */
  .fade-in {
    animation: fadeSlide 0.35s ease-out;
  }
  @keyframes fadeSlide {
    from { opacity: 0; transform: translateY(-4px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .decale {
  margin-left: 2cm; /* d√©cale de 1 cm vers la droite */
}
 
#titre { width: 89%; }
#annee { width: 20%; }
/* background-color: lightyellow;  */


.form-flex {
  display: flex;
  gap: 20px;
}

.form-flex > div {
  flex: 1; /* chaque bloc prend la moiti√© */
}

/* ‚úÖ Responsive */
@media (max-width: 600px) {
  .form-flex {
    flex-direction: column; /* empile les blocs */
  }
}

.cache {display: none;}
#monId:empty {
  display: none;
}
.adroite {
        display: flex;
        text-align: right;}

/* pour toggle references */

.bloc-typeRef {
  border: 1px solid #ccc;
  padding: 10px;
  max-width: 600px;
}

.headerRef {
  display: flex;
  justify-content: space-between; /* titre √† gauche, bouton √† droite */
  align-items: center;
  margin-bottom: 10px;
width: 100%;
 
  bottom: 0;       /* colle en bas */
  left: 0;

 
 
 
}

.footer {
  position: fixed;/* colle en bas */
  bottom: 0;       /* colle en bas */
  left: 0;
  width: 100%;     /* occupe toute la largeur */
  background: #eee;
  text-align: center;
  padding: 10px;
}


.titleRef {
  font-weight: bold;
  font-size: 1.2em;
}

.toggle-btnRef {
  font-size: 1.5em;       /* plus gros */
  color: blue;            /* texte bleu */
  background: none;       /* pas de fond */
  border: none;           /* pas de bordure */
  cursor: pointer;
}

/*  D√âBUT affichage licence GNU */
/* Bouton discret fix√© en bas √† droite */
.apropos-btn {  
  position: absolute;/* plus gros */
  bottom: 15px;
  right: 20px;
  font-size: 0.9em;
  color: #0066cc;
  background: none;
  border: 1px solid #0066cc;
  border-radius: 4px;
  padding: 6px 12px;
  cursor: pointer;
  opacity: 0.8;
}
.apropos-btn:hover {
  opacity: 1;
  background: #f0f8ff;
}

.tooltip {
  position: absolute;
  background: #333;
  color: #fff;
  padding: 8px 10px;
  border-radius: 4px;
  font-size: 0.9em;
  display: none;
  max-width: 220px;
  z-index: 1000;
}


/*
.cc-small {
  width: 186px;
  height: 123px;
 
} 
 */
/* 
.cc-small {
  width: 50%;
  height: auto;
} 
*/
/*
.cc-small { transform: scale(0.5); transform-origin: top left; display: inline-block; }
 */

/* 
.cc-icon {
  display: inline-block;
  transform: scale(0.4);
  transform-origin: top left;
}

.cc-icon img {
  display: block; 
}
 /* */

.cc-table {
  border-collapse: collapse;
  width: 100%;
}

.cc-table td {
  border: 1px solid #ccc;
  vertical-align: middle;
  padding: 10px;
}

/* Colonne 1 : largeur auto selon l‚Äôimage */
.cell-icon {
  width: 1%;
  white-space: nowrap;
  text-align: center;
}

/* Image r√©duite √† 50% (88√ó31 ‚Üí 44√ó16) */
.cc-50 {
  width: 88px;
  height: 31px;
  display: block;
  margin: 0 auto;
  
}


/* Colonne 2 : align√©e √† gauche, centr√©e verticalement */
.cell-text {
  text-align: left;
}



/* Image r√©duite √† 50‚ÄØ% (88√ó31 ‚Üí 44√ó16) 
.cc-50 { width: 44px; height: 16px; display: block; margin: 0 auto; }*/ 

/* Fen√™tre modale */
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background-color: rgba(0,0,0,0.5);
}
.modal-content {
  background: #fff;
  margin: 5% auto;
  padding: 20px;
  width: 80%;
  max-width: 700px;
  border-radius: 6px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  overflow-y: auto;
  max-height: 80%;
}
.close {
  float: right;
  font-size: 1.5em;
  cursor: pointer;
  color: #333;
} /* */
.close:hover {
  color: red;
}

/* ****FIN GNU ************** */

</style>


  <script>
    // Encodage des caractÔøΩres FR + & en entitÔøΩs HTML numÔøΩriques
    function encodeFrenchEntities(str) {
      if (!str) return '';
      const map = {
        '&':'&#38;', 'ÔøΩ':'&#224;','ÔøΩ':'&#226;','ÔøΩ':'&#228;','ÔøΩ':'&#231;','ÔøΩ':'&#233;','ÔøΩ':'&#232;','ÔøΩ':'&#234;','ÔøΩ':'&#235;',
        'ÔøΩ':'&#238;','ÔøΩ':'&#239;','ÔøΩ':'&#244;','ÔøΩ':'&#246;','ÔøΩ':'&#249;','ÔøΩ':'&#251;','ÔøΩ':'&#252;','ÔøΩ':'&#255;','ÔøΩ':'&#339;','ÔøΩ':'&#230;',
        'ÔøΩ':'&#192;','ÔøΩ':'&#194;','ÔøΩ':'&#196;','ÔøΩ':'&#199;','ÔøΩ':'&#201;','ÔøΩ':'&#200;','ÔøΩ':'&#202;','ÔøΩ':'&#203;','ÔøΩ':'&#206;','ÔøΩ':'&#207;',
        'ÔøΩ':'&#212;','ÔøΩ':'&#214;','ÔøΩ':'&#217;','ÔøΩ':'&#219;','ÔøΩ':'&#220;','ÔøΩ':'&#376;','ÔøΩ':'&#338;','ÔøΩ':'&#233;'
      };
	  //'ÔøΩ':'&#198;'
      return str.replace(/[&ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ‹üÔøΩÔøΩ]/g, ch => map[ch] || ch);
    }

//   const licences_URL = {
//     "1": "https://creativecommons.org/licenses/by/4.0/deed.fr",
//     "2": "https://creativecommons.org/licenses/by-sa/4.0/deed.fr",
//     "3": "https://creativecommons.org/licenses/by-nc/4.0/",
//     "4": "https://creativecommons.org/licenses/by-nc-sa/4.0/",
//     "5": "https://creativecommons.org/licenses/by-nd/4.0/deed.fr",
//     "6": "https://creativecommons.org/licenses/by-nc-nd/4.0/"
//   };
// const licences_ic = {
//     "1": "https://mirrors.creativecommons.org/presskit/buttons/88x31/png/by.png",
//     "2": "https://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-sa.png",
//     "3": "http://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-nc.png",
//     "4": "http://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-nc-sa.png",
//     "5": "https://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-nd.png",
//     "6": "http://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-nc-nd.png"
//   };

  const licences = {
  "1": {
    url: "https://creativecommons.org/licenses/by/4.0/deed.fr",
    icon: "https://mirrors.creativecommons.org/presskit/buttons/88x31/png/by.png"
  },
  "2": {
    url: "https://creativecommons.org/licenses/by-sa/4.0/deed.fr",
    icon: "https://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-sa.png"
  },
  "3": {
    url: "https://creativecommons.org/licenses/by-nc/4.0/",
    icon: "https://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-nc.png"
  },
  "4": {
    url: "https://creativecommons.org/licenses/by-nc-sa/4.0/",
    icon: "https://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-nc-sa.png"
  },
  "5": {
    url: "https://creativecommons.org/licenses/by-nd/4.0/deed.fr",
    icon: "https://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-nd.png"
  },
  "6": {
    url: "https://creativecommons.org/licenses/by-nc-nd/4.0/",
    icon: "https://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-nc-nd.png"
  }
};


    // Regex simples mais efficaces pour tester email et URL
    const regexURL = /^(https?:\/\/)[\w.-]+(\.[a-z]{2,})(\/.*)?$/i;
    const regexEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    let boutonActif = 1; //1=ajustee, 2=adaptee-tab1, 3=adaptee-tab3, 4=ajuteee

    const remplirTextBrut = "Remplir les champs du formulaire pour g&#233;n&#233;rer un libell&#233; d'attribution CC conforme."
    const remplirTexte2 = "Remplir les champs des <strong>2 onglets du formulaire</strong> pour g&#233;n&#233;rer un libell&#233; d'attribution CC conforme."

  //FONCTIONS DES 3 OPTIONS

 function resetInputsExceptRadios() {
  const bloc1 = document.getElementById("tab1");
  bloc1.querySelectorAll("input").forEach(input => {
  input.value = "";
  });
  const bloc2 = document.getElementById("tab2");
  bloc2.querySelectorAll("input").forEach(input => {
  input.value = "";
  });
    document.getElementById("choix_lic0").selectedIndex = 0;
    document.getElementById("choix_lic").selectedIndex = 0;

   document.getElementById("btnCopier1").style.display = 'none'; 
   document.getElementById("btnCopier2").style.display = 'none'; 

    // updateOutput();
    // updateOutput0();
    // InitialiserCit();
    // validerTitreProfil();
    // validerTitreProfil0();
}

function afficherEncadre() {
    document.querySelector('.container').style.display = 'grid';
    document.getElementById('generer').style.display = 'flex'; ;
    document.getElementById('remplir').style.display = 'flex'; ;
}

function fonctionOriginale() {
    ShowTitles();
    //alert("Fonction pour ≈ìuvre originale ex√©cut√©e");
    document.getElementById('boutons').style.display = 'flex';    
    //openTab('tab1', null);
    //alert("goo");
   //alert (btn.id);
    const btn = document.querySelector('.tab-buttons button[data-tab="tab1"]'); // quel tab?
    //alert (btn.id);
    openTab('tab1', btn);
   // alert (btn.id);
    afficherEncadre();
    document.getElementById("btn1").style.display = ""; //bouton visible
    document.getElementById("btn2").style.display = "none";//bouton invisible
    document.getElementById('remplir').innerHTML= remplirTextBrut;
    AfficheAdjustAdapt();
    // document.getElementById("Attrib1").style.display = "";            
    // document.getElementById("Attrib2").style.display = "none";        
    // document.getElementById("AdjustOutPrez").style.display = "none";
    // document.getElementById("AdapTransit").style.display = "none";
    // document.getElementById("AdaptOutPrez").style.display = "none";
    // document.getElementById("blocAdjustIn").style.display = "none";
    // document.getElementById("blocAdaptIn").style.display = "";   
    document.getElementById("Explications").textContent = "Vous √™tes titulaire(s) des droits d'auteur sur cette oeuvre parce qu'elle est totalement originale."; 
    }

function AfficheAdjustAdapt() {
  const z = zone();

 // table de correspondance : [Attrib3, Attrib4, blocAdjustIn, blocAdaptIn, AdapTransit, Attrib2]
// "Attrib3";//Adjust
// "Attrib4";//Adapt
// "blocAdjustIn";
// "blocAdaptIn";
// "AdapTransit";
// "Attrib2";//Source


  const displayMap = {
    1: ['none', 'none', 'none', 'none', 'none', 'none'],
    2: ['none', 'flex', 'none', 'flex', 'flex', 'flex'],
    3: ['none', 'flex', 'none', 'flex', 'flex', 'flex'],
    4: ['flex', 'none', 'flex', 'none', 'none', 'none']
  };

  const ids = ["Attrib3", "Attrib4", "blocAdjustIn", "blocAdaptIn", "AdapTransit", "Attrib2"];

  if (displayMap[z]) {
    ids.forEach((id, i) => {
      const el = document.getElementById(id);
      if (el) el.style.display = displayMap[z][i];
    });
  }
}

    function fonctionAdaptee() {
        ShowTitles();
    // alert("Fonction pour ≈ìuvre adapt√©e ex√©cut√©e");
    document.getElementById("boutons").style.display = "flex";        
    const btn = document.querySelector('.tab-buttons button[data-tab="tab1"]');
    openTab('tab1', btn);
    afficherEncadre();
    document.getElementById("btn1").style.display = ""; //bouton visible
    document.getElementById("btn2").style.display = "";//bouton visible
    document.getElementById('remplir').innerHTML= remplirTexte2;
    AfficheAdjustAdapt();            
    document.getElementById("Explications").textContent ="Parce que vous avez modifi√© une oeuvre de fa√ßon substantielle,vous √™tes titulaire(s) des droits d'auteur sur la nouvelle oeuvre. Vous devez fournir les donn√©es sur cette oeuvre et sur l'oeuvre d'origine, et pr√©ciser les adaptations effectu√©es.";    
}

    function fonctionAjustee() {
        ShowTitles();
    //   alert("Fonction pour ≈ìuvre ajust√©e ex√©cut√©e");
    document.getElementById("boutons").style.display = "flex";
    //alert ("test");
    const btn = document.querySelector('.tab-buttons button[data-tab="tab2"]');
    afficherEncadre(); 
    
    openTab('tab1', btn);   //affiche l'onglet de l'oeuvre originales
    document.getElementById("btn1").style.display = "none"; //bouton invisible
    document.getElementById("btn2").style.display = "";//bouton visible   
    document.getElementById('remplir').innerHTML= remplirTextBrut;
    AfficheAdjustAdapt();         
    document.getElementById("Explications").textContent = "Vous n'avez modifi√© que l√©g√®rement une oeuvre, et donc vous n'√™tes pas titulaire(s) des droits d'auteur. Vous devez attribuer l'oeuvre aux auteurs d'origine, et pr√©ciser les ajustements effectu√©s."; 
}

function getSelectedType() {
  return document.querySelector('input[name="type"]:checked')?.value;
}

function ShowTitles() {
document.querySelectorAll(".title-out").forEach(el => {
el.style.display = "block";
});
}

function zone() {
  const type = getSelectedType();

  if (type === "originale") return 1;

  if (type === "adaptee") {
 //   const id = boutonActif?.id;   // safe access
    if (boutonActif.id === "btn1") return 2;
    if (boutonActif.id === "btn2") return 3;
    return 0;
  }

  if (type === "ajustee") return 4;

  return 0;
}


// function InitialiserCit() {
//         const LeType = getSelectedType(); //quel type d'oeuvre     
//  //r√©initiaisation Citation et URLs
//         document.getElementById('outCreateursCit').innerHTML = "Cr√©ateurs"; 
//         document.getElementById('outAnneeCit').innerHTML = "Ann√©e"; 
//         document.getElementById('outTitreCit').innerHTML = "Titre de l&#339;uvre";               
//           document.getElementById('outEditCit').innerHTML = "Organisation √©ditrice"; 
        
//         const outLicenceLink = document .getElementById('outLicenceLink');
//         if (outLicenceLink) {
//             outLicenceLink.innerHTML = "&laquo; Licence √† choisir &raquo;"; 
//             outLicenceLink.removeAttribute('href');
//         } 
//         const outLinkCit = document.getElementById('outLinkCit');
//         if (outLinkCit) {
//             outLinkCit.innerHTML = "DOI ou URL"; 
//             outLinkCit.removeAttribute('href');
//         } 
//         const outLicenceLinkCit = document.getElementById('outLicenceLinkCit');
//         if (outLicenceLinkCit) {
//             outLicenceLinkCit.innerHTML = "&laquo; Licence √† choisir &raquo;"; 
//             outLicenceLinkCit.removeAttribute('href');
//         } 
//         }   

// function FormValider(z) {

// ["titre_url", "titre_url0", "createurs_profil", "createurs_profil0"]
//   .forEach(id => {
//     const el = document.getElementById(id);
//     if (el) el.classList.remove("highlight");
//   });

//   const baseChamps = ["titre", "tabAuteursL1", "annee", "choix_lic"];
//   const champsMap = {
//     1: [...baseChamps],
//     2: [...baseChamps, "titre0", "tabAuteurs0L1", "annee0", "choix_lic0", "AdaptIn"],
//     3: [...baseChamps, "titre0", "tabAuteurs0L1", "annee0", "choix_lic0", "AdaptIn"],
//     4: [...baseChamps, "AdjustIn"]
//   };

//   let valide = true;
//   const champs = (champsMap[z] || []).map(id => document.getElementById(id));
//   champs.forEach(champ => {
//     if (!champ) return; // s√©curit√© si un id est manquant
//     champ.classList.remove("highlight");
//     if (!champ.value.trim()) {
//       champ.classList.add("highlight");
//       valide = false;
//     }
//   }
// );


//   if (!valide) {
//     const msg = (z === 1 || z === 4)
//       ? "Veuillez remplir tous les champs obligatoires (*)"
//       : "Veuillez remplir tous les champs obligatoires (*) dans les 2 onglets";
//     alert(msg);
//   }

//   return valide;
// }


function FormValider(z) {
  ["titre_url", "titre_url0", "createurs_profil", "createurs_profil0"]
    .forEach(id => {
      const el = document.getElementById(id);
      if (el) el.classList.remove("highlight");
    });

  const baseChamps = ["titre", "tabAuteursL1", "annee", "choix_lic"];
  const champsMap = {
    1: [...baseChamps],
    2: [...baseChamps, "titre0", "tabAuteurs0L1", "annee0", "choix_lic0", "AdaptIn"],
    3: [...baseChamps, "titre0", "tabAuteurs0L1", "annee0", "choix_lic0", "AdaptIn"],
    4: [...baseChamps, "AdjustIn"]
  };

  let valide = true;
  const champs = (champsMap[z] || []).map(id => document.getElementById(id));

  champs.forEach(champ => {
    if (!champ) return; // s√©curit√© si un id est manquant
    champ.classList.remove("highlight");

    if (!champ.value.trim()) {
      champ.classList.add("highlight");
      valide = false;

      // üîß Ajout d‚Äôun √©couteur pour enlever le highlight d√®s qu‚Äôon clique ou tape dedans
      champ.addEventListener("focus", () => champ.classList.remove("highlight"), { once: true });
      champ.addEventListener("input", () => champ.classList.remove("highlight"), { once: true });
    }
  });

  if (!valide) {
    const msg = (z === 1 || z === 4)
      ? "Veuillez remplir tous les champs obligatoires (*)"
      : "Veuillez remplir tous les champs obligatoires (*) dans les 2 onglets";
    alert(msg);
  }

  return valide;
}


 //fonctions de G√âN√âRATION
function AfficherAttribCit() {//oeuvre 1
    //alert("coucou")   ;

    switch (zone()) {
        case 1:
            if (FormValider(1)) updateOutput();
            break;
        case 2:
        case 3:
            if (FormValider(3)) {
            updateOutput();
            updateOutput0();
            }
            break;
        case 4:
            if (FormValider(4)) updateOutput();
            break;
        default:
            // code if none of the cases match
    } 
}   


// Fonction utilitaire : r√©cup√®re la valeur, applique trim et encode
function getEncodedValue(id, defaultText) {
  const el = document.getElementById(id);
  const value = (el?.value || "").trim();
  return encodeFrenchEntities(value || defaultText);
}

// Mapping entr√©e ‚Üí sortie
// Mapping selon z
const mappings = {
  1: [
    { inId: "titre", outId: "outTitre", defaultText: "Titre de l'≈ìuvre" },
    { inId: "createurs_tableAuteurs", outId: "outCreateurs", defaultText: "Cr√©ateurs" },
    { inId: "annee", outId: "outAnnee", defaultText: "Ann√©e" },
// Citation
    { inId: "createursAPA_tableAuteurs", outId: "outCreateursCit", defaultText: "Cr√©ateurs" },
    { inId: "annee", outId: "outAnneeCit", defaultText: "Ann√©e" },
    { inId: "titre", outId: "outTitreCit", defaultText: "" },
    { inId: "titre_url", outId: "outLinkCitText", defaultText: "" },    
    { inId: "organ", outId: "outEditCit", defaultText: "" }  
  ],
  2: [
    { inId: "titre", outId: "outTitre", defaultText: "Titre de l'≈ìuvre" },
    { inId: "createurs_tableAuteurs", outId: "outCreateurs", defaultText: "Cr√©ateurs" },
    { inId: "annee", outId: "outAnnee", defaultText: "Ann√©e" },
 //Oeubre d'origine   
    { inId: "titre0", outId: "outTitre0", defaultText: "Titre de l'≈ìuvre" },
    { inId: "createurs_tableAuteurs", outId: "outCreateurs0", defaultText: "Cr√©ateurs" },
    { inId: "annee0", outId: "outAnnee0", defaultText: "Ann√©e" },
// Citation
   { inId: "createursAPA_tableAuteurs", outId: "outCreateursCit", defaultText: "Cr√©ateurs" },
    { inId: "annee", outId: "outAnneeCit", defaultText: "Ann√©e" },
    { inId: "titre", outId: "outTitreCit", defaultText: "" },
    { inId: "titre_url", outId: "outLinkCitText", defaultText: "" },    
    { inId: "organ", outId: "outEditCit", defaultText: "" },  
  // Adaptation  
    { inId: "AdaptIn", outId: "AdaptOut", defaultText: "" }
  ],
  3: [null  // on va pointer vers 2 parcqu'identique (2 boutons)
  ],
  4: [
    { inId: "titre", outId: "outTitre", defaultText: "Titre de l'≈ìuvre" },
    { inId: "createurs_tableAuteurs", outId: "outCreateurs", defaultText: "Cr√©ateurs" },
    { inId: "annee", outId: "outAnnee", defaultText: "Ann√©e" },
    { inId: "organ", outId: "outEditCit", defaultText: "Organisation √©ditrice" },
// Citation
   { inId: "createursAPA_tableAuteurs", outId: "outCreateursCit", defaultText: "Cr√©ateurs" },
    { inId: "annee", outId: "outAnneeCit", defaultText: "Ann√©e" },
    { inId: "titre", outId: "outTitreCit", defaultText: "" },
    { inId: "titre_url", outId: "outLinkCitText", defaultText: "" },    
    { inId: "organ", outId: "outEditCit", defaultText: "" },  

    { inId: "AdjustIn", outId: "AdjustOut", defaultText: "" }
  ]

};

function setHighlight(el, condition) {
  if (!el) return;
  if (condition) {
    el.classList.add("highlight");
  } else {
    el.classList.remove("highlight");
  }
}

const config = {
  titre: {
    sourceId: "titre_url",
    outputs: ["outTitre","outLinkCitText"],
    handler: (val, outEl) => {
      if (!regexURL.test(val)) {
        if (val) {
          alert("Oeuvre : URL non conforme : veuillez corriger.");
          document.getElementById("titre_url").classList.add("highlight");
        }
        return null;
      }
      return { href: val, text: outEl.textContent || val };
    }
  },

  titre0: {
    sourceId: "titre_url0",
    outputs: ["outTitre0"],
    handler: (val, outEl) => {
      if (!regexURL.test(val)) {
        if (val) {
          alert("Oeuvre : URL non conforme : veuillez corriger");
          document.getElementById("titre_url0").classList.add("highlight");
        }
        return null;
      }
      return { href: val, text: outEl.textContent || val };
    }
  },

  profil: {
    sourceId: "createurs_profil",
    outputs: ["outCreateurs"],
    handler: (val, outEl) => {
      if (regexURL.test(val)) return { href: val, text: outEl.textContent || val };
      if (regexEmail.test(val)) return { href: "mailto:" + val, text: outEl.textContent || val };
      if (val) {
        alert("Cr√©ateurs : URL ou adresse courriel non conforme : veuillez corriger");
        document.getElementById("createurs_profil").classList.add("highlight");
      }
      return null;
    }
  },

  profil0: {
    sourceId: "createurs_profil0",
    outputs: ["outCreateurs0"],
    handler: (val, outEl) => {
      if (regexURL.test(val)) return { href: val, text: outEl.textContent || val };
      if (regexEmail.test(val)) return { href: "mailto:" + val, text: outEl.textContent || val };
      if (val) {
        alert("Cr√©ateurs : URL ou adresse courriel non conforme : veuillez corriger");
        document.getElementById("createurs_profil0").classList.add("highlight");
      }
      return null;
    }
  },

  licence: {
    sourceId: "choix_lic",
    outputs: ["outLicenceLink", "outLicenceLinkCit"],
    handler: (val, outEl, sourceEl) => {
      const optionTexte = sourceEl.options[sourceEl.selectedIndex].text;
      if (!val) return { href: "", text: optionTexte };
      return { href: licences[val].url || optionTexte, text: optionTexte };
    }
  },

   licence0: {
    sourceId: "choix_lic0",
    outputs: ["outLicenceLink0"],
    handler: (val, outEl, sourceEl) => {
      const optionTexte = sourceEl.options[sourceEl.selectedIndex].text;
      if (!val) return { href: "", text: optionTexte };
      return { href: licences[val].url || optionTexte, text: optionTexte };
    }
  }
};

function majLien(key) {
  const conf = config[key];
  if (!conf) return;

  const sourceEl = document.getElementById(conf.sourceId);
  if (!sourceEl) return;

  const val = sourceEl.value?.trim() || sourceEl.value || "";
  conf.outputs.forEach(id => {
    const outEl = document.getElementById(id);
    if (!outEl) return;

    const result = conf.handler(val, outEl, sourceEl);
    if (!result) return;

    if (result.href) {
      outEl.innerHTML = `<a href="${result.href}" target="_blank">${result.text}</a>`;
    } else {
      outEl.textContent = result.text;
      outEl.removeAttribute("href");
    }
  });
}

function updateOutput() {//oeuvre 1   
    const z=zone();
    mappings[3] = mappings[2];
    const fields = mappings[z] || [];
    fields.forEach(({ inId, outId, defaultText }) => {
        const encoded = getEncodedValue(inId, defaultText);
        const outEl = document.getElementById(outId);
        if (outEl) outEl.innerHTML = encoded;
  });
      
    majLien("titre");
    majLien("profil");
    majLien("licence");
    // Correction de ponctuation
    AjoutePointEspace("outLinkCitText");
    AjoutePointEspace("outEditCit");
    majLicence();
    //Affiche boutons  "Copier"
    document.getElementById('btnCopier1').style.display = 'block';
    document.getElementById('btnCopier2').style.display = 'block';
   // updateURLTitreCitation();
}

function updateOutput0() { //oeuvre 0 = source
        majLien("titre0");
        majLien("profil0");
        majLien("licence0");
       // Correction de ponctuation
       AjoutePointEspace("outLinkCitText");
       AjoutePointEspace("outEditCit");        
}

function AjoutePointEspace(id) {
  const el = document.getElementById(id);
  if (el) {
    const contenu = el.innerHTML.trim();
    if (contenu.length > 0) {
      // V√©rifie si √ßa ne finit pas d√©j√† par ". "
      if (!contenu.endsWith(". ")) { // attention : espace ins√©cable
        el.innerHTML = contenu + ".&nbsp;";
      }
    }
  }
}



function openTab(LeTab, btn) {
  // cacher tous les contenus
 boutonActif = btn; 
  //const LeType = getSelectedType(); //quel type d'oeuvre
 const z= zone();
 if (z===4) {LeTab='tab1'} //on demeure sur l'onglet de l'oeuvre d'origine
  document.querySelectorAll('.tab-content').forEach(div => { 
    div.style.display = 'none';
  });

  // afficher le bon onglet
  document.getElementById(LeTab).style.display = 'block';
 
  // retirer l‚Äôemphase de tous les boutons
  document.querySelectorAll('.tab-buttons button').forEach(b => {
    b.classList.remove('active-tab');

  });

  // ajouter l‚Äôemphase au bouton cliqu√©
 // if (z===4) {btn = document.querySelector('.tab-buttons button[data-tab="tab1"]');}
  btn.classList.add('active-tab');

 AfficheAdjustAdapt();

}

 async function copierDansClipboard(id) {
  const el = document.getElementById(id);
  if (el) {
    let html = el.innerHTML;   // r√©cup√®re tout le HTML interne (avec liens)
    let text = el.textContent; // version brute

// üîß Normalisation : remplacer &nbsp; par un espace simple
    html = html.replace(/&nbsp;/g, " ");
    text = text.replace(/\u00A0/g, " "); // \u00A0 = espace ins√©cable

    try {
      await navigator.clipboard.write([
        new ClipboardItem({
          "text/plain": new Blob([text], { type: "text/plain" }),
          "text/html": new Blob([html], { type: "text/html" })
        })
      ]);
      alert("Bloc copi√© avec ses liens !");
    } catch (err) {
      console.error("Erreur de copie :", err);
    }
  }
}

  </script>

</head>

<!--**************************BODY************************************-->
<body>
 
  <h1>G√©n√©rateur d'attribution et de citation d'une &#339;uvre</h1>

 <div class="bloc-type"> 
<!-- <div style="display: flex; justify-content: space-between; align-items: center;"></div>    
  -->  
 <div style="margin-top: 10px; font-size: 1.2rem; font-weight: bold;">
    <strong>Type&nbsp;:</strong>
</div>

  <div class="radio-group">
    <label>
       <input type="radio" name="type" value="originale" checked onclick="fonctionOriginale();resetInputsExceptRadios();">
          Originale
    </label>

      <label>
      <input type="radio" name="type" value="adaptee" onclick="fonctionAdaptee();resetInputsExceptRadios();">
      Adapt√©e (d√©riv√©e)
    </label>
    
    <label>
      <input type="radio" name="type" value="ajustee" onclick="fonctionAjustee();resetInputsExceptRadios();">
      Ajust√©e (l√©g√®rement modifi√©e)
    </label>
  </div>
  <!-- <div class="explication" id="Explications">Bienvenue. Ce g√©n√©rateur vous permettra de cr√©er une attribution Creative Commons conforme pour votre oeubre ainsi qu'une citation APA.</div> -->
     <div class="explication" id="Explications"></div>
</div>

<!--  2 BOUTONS VERS ONGLETS-->
<div style="display: flex; justify-content: space-between; align-items: center;">
 <div class="tab-buttons" id="boutons">
      <button id="btn1" data-tab="tab1" onclick="openTab('tab1', this)">Infos sur votre oeuvre</button>
      <button id="btn2" data-tab="tab2" onclick="openTab('tab2', this)">Infos sur l'oeuvre d'origine</button>
    </div>

<span class="quote" id="remplir" >Remplir les champs du formulaire pour g&#233;n&#233;rer un libell&#233; d'attribution CC conforme.
</span>
<span class="droite" id="generer">
<button class="bouton-grand" id="btn_generer"  onclick="AfficherAttribCit()";>G√©n√©rer</button>
</span>
</div>
<!--**************************BODY************************************-->
<div class="container">
    <div class="col1">
        <div class="tabs">
        <!-- Colonne 1, TAB1 : SAISIE Oeuvre 1--> 
            <div id="tab1" class="tab-content">
                <div class="panel">
                <h2>Informations de saisie</h2>
<!-- size="200" -->
                *Titre de l'&#339;uvre</label>
                <input type="text" id="titre" placeholder="Ex.: ma Super ressource">

                <label for="titre_url" class="decale" >Lien vers l'&#339;uvre</label>
                <input type="url" id="titre_url" class="decale" placeholder="Ex. https://www.enseigner.ulaval.ca/pedagogie/bonnes-pratiques-denseignement">

                <label for="createurs">*Identification des autrices et auteurs</label>
<!-- <table id="tableAuteurs">
  <thead>
    <tr>
      <th>Nom(s)</th>
      <th>Pr√©nom(s)</th>
      <th>Organisation</th>
      <th>+ Ligne</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><input type="text" value="" placeholder="Ex. Dupont"></td>
      <td><input type="text" value="" placeholder="Ex. Josette"></td>
      <td><input type="checkbox"></td>
      <td class="add-row"><strong>+</strong></td>
    </tr>
  </tbody>
</table> -->

<!-- ***************************************** -->
<!-- <h2>Table Auteurs 1</h2> -->
<table id="tableAuteurs" class="table-auteurs">
  <thead>
    <tr>
      <th>Nom(s)</th>
      <th>Pr√©nom(s)</th>
      <th title="Cocher s'il s'agit d'une organisation">Organisation</th>
      <th title="Clic sur + pour ajouter une ligne.&#10;Pour trier plusieurs lignes, glisser-d√©poser." class="tooltip-trigger">?</th>
<div id="tooltip" class="tooltip">
  Clic sur + pour ajouter une ligne.<br>
  Pour trier plusieurs lignes, glisser-d√©poser.
</div>

    </tr>
  </thead>
  <tbody>
    <tr>
      <td><input id="tabAuteursL1" type="text" placeholder="Ex. Dupont"></td>
      <td><input type="text" placeholder="Ex. Josette"></td>
      <td><input type="checkbox"></td>
      <td class="add-row"><strong>+</strong></td>
    </tr>
  </tbody>
</table>

<!-- Sorties g√©n√©r√©es automatiquement mais cach√©es-->
 <div class="cache">
<label>Cr√©ateurs :</label><br>
<input type="text" id="createurs_tableAuteurs" style="width:400px"><br><br>

<label>Sortie APA :</label><br>
<input type="text" id="createursAPA_tableAuteurs" style="width:400px"><br><br> 
</div>


<!-- ************************************** -->

<!-- <h3>Sortie 1 (Pr√©nom avant Nom)</h3>
<textarea id="createurs" readonly></textarea> 
<textarea id="createurs" readonly></textarea>

<h3>Sortie 2 (Style APA)</h3>
<textarea id="createursAPA" readonly></textarea>-->

                <!-- <input type="text" id="createurs" placeholder="Ex. Marie Tremblay"> -->

                <!-- <label for="createursPers">*Noms et pr√©noms des cr&eacute;ateurs (s√©par√©s par virgule, 1 par ligne)</label>
                <input type="text" id="createursPers" placeholder="Ex.  Tremblay, Marie">

                <label for="createursOrg">*Nom des organisations (1 par ligne)</label>
                <input type="text" id="createursOrg" placeholder="Universit√© Laval"> -->

                <label for="createurs_profil" class="decale">URL ou adresse courriel de contact</label>
                <input type="text" id="createurs_profil" class="decale" placeholder="http://sse.ulaval.ca ou sse@ulaval.ca">
<p></p>              
             <div class="form-flex"> 
                <div>
                    <h2>*Licence Creative Commons :</h2>
                    <!-- <label for="choix_lic">Menu dÔøΩroulant :</label>--> 
                    <select id="choix_lic" >
                    <option value="">-- S&eacute;lectionnez --</option>
                    <option value="1">CC BY 4.0</option>
                    <option value="2" selected>CC BY-SA 4.0</option>
                    <option value="3">CC BY-NC 4.0</option>
                    <option value="4">CC BY-NC-SA 4.0</option>
                    <option value="5">CC BY-ND 4.0</option>
                    <option value="6">CC BY-NC-ND 4.0</option>
                    </select>
                </div>        
                <div>        
                    <label for="annee">*Ann&eacute;e de cr&eacute;ation</label>
                    <input type="number" id="annee"  max="2050" min="1960" placeholder="Ex. 2025">

                </div> 
            </div> 
                <label for="organ">Organisation √©ditrice (si pas dans les auteurs)</label>
                <input type="text" id="organ" placeholder="Universit√© Laval">
<p></p>
            <div class="bloc-type2" id="blocAdjustIn">
            <label for="AdjustLabel">*Ajustements effectu√©s</label>
            <input type="text" id="AdjustIn" placeholder="Quelques mots chang√©s, fautes corrig√©es, changement de couleur, etc.">
        </div>

        <!-- <div class="bloc-type" id="blocAdaptIn">
            <label for="AdaptLabel">Adaptations effectu√©es : </label>
            <input type="text" id="AdaptIn" placeholder="Ajout d'une section compl√®te, changement de format, traduction, etc.">
        </div> -->

                    <!--    <p class="help">Saisissez normalement (ÔøΩ, ÔøΩ, ÔøΩ, ÔøΩ). La sortie encode les caractÔøΩres en entitÔøΩs HTML.</p>-->
            </div><!--panel-->



        </div> <!--tab1-->
    </div><!--tabs-->

        <!--**************************BODY************************************-->
            <!-- Colonne 1, TAB2 : SAISIE Oeuvre 0 SOURCE (s'il y a lieu)--> 
            <div id="tab2" class="tab-content" style="display:none;">
                <div class="panel">
                <h2>Informations de saisie</h2>

                <label for="titre">*Titre de l'&#339;uvre</label>
                <input type="text" id="titre0" placeholder="Ex.: ma Super ressource">

                  <label for="titre_url0 class="decale" >Lien vers l'&#339;uvre</label>
                <input type="url" id="titre_url0" class="decale" placeholder="Ex. https://www.enseigner.ulaval.ca/pedagogie/bonnes-pratiques-denseignement">

<!-- ****************************************** -->
<!-- <h2>Table Auteurs 2</h2> -->
 <label for="createurs">*Identification des autrices et auteurs</label>
<table id="tableAuteurs0" class="table-auteurs">
  <thead>
    <tr>
      <th>Nom(s)</th>
      <th>Pr√©nom(s)</th>
      <th>Organisation</th>
      <th title="Clic sur + pour ajouter une ligne.&#10;Pour trier plusieurs lignes, glisser-d√©poser.">?</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><input id="tabAuteurs0L1" type="text" placeholder="Ex. Tremblay"></td>
      <td><input type="text" placeholder="Ex. Marc"></td>
      <td><input type="checkbox"></td>
      <td class="add-row"><strong>+</strong></td>
    </tr>
  </tbody>
</table>

<!-- Sorties g√©n√©r√©es automatiquement mais cach√©es-->
 <div class="cache">
<label>Cr√©ateurs :</label><br>
<input type="text" id="createurs_tableAuteurs0" style="width:400px"><br><br>

<label>Sortie APA :</label><br>
<input type="text" id="createursAPA_tableAuteurs0" style="width:400px"><br><br> 
</div>

<!-- ************************************** -->

                <!-- <label for="createurs">*Nom complet des cr&eacute;ateurs (reprendre le nom inscrit sur l'oeuvre)</label>
                <input type="text" id="createurs0" placeholder="Ex. Marie Tremblay"> -->

                <label for="createurs_profil" class="decale">URL ou adresse courriel de contact</label>
                <input type="text" id="createurs_profil0" class="decale" placeholder="http://sse.ulaval.ca ou sse@ulaval.ca">
<p></p>              
             <div class="form-flex"> 
                <div>
                    <h2>*Licence Creative Commons :</h2>
                    <!-- <label for="choix_lic">Menu dÔøΩroulant :</label>--> 
                    <select id="choix_lic0" >
                    <option value="">-- S&eacute;lectionnez --</option>
                    <option value="1">CC BY 4.0</option>
                    <option value="2">CC BY-SA 4.0</option>
                    <option value="3">CC BY-NC 4.0</option>
                    <option value="4">CC BY-NC-SA 4.0</option>
                    <option value="5">CC BY-ND 4.0</option>
                    <option value="6">CC BY-NC-ND 4.0</option>
                    </select>
                </div>        
                <div>        
                    <label for="annee0">*Ann&eacute;e de cr&eacute;ation</label>
                    <input type="number" id="annee0"  max="2050" min="1960" placeholder="Ex. 2025">

                </div> 
            </div> 
                <label for="organ0">Organisation √©ditrice (si pas dans les auteurs)</label>
                <input type="text" id="organ0" placeholder="Universit√© Laval">
<p></p>
        <div class="bloc-type2" id="blocAdaptIn">
            <label for="AdaptLabel">*Adaptations effectu√©es : </label>
            <input type="text" id="AdaptIn" placeholder="Ajout d'une section compl√®te, changement de format, traduction, etc.">
        </div>
        </div> <!--fin class="panel"-->

            </div><!--fin class="tab2"-->

    </div> <!--fin class="col1"-->

            

        <!--  ********************************************************** -->
        <!-- Colonne 2 : SORTIE -->
    <div class="col2">
        <div class="title-out" id="AttribOutTitre">ATTRIBUTION RECOMMAND&Eacute;E<p></p>
        </div>
        
        <div class ="" id="Attributions" >
            <span id="Attrib1">

<table class="cc-table">
  <tr>
    <td class="cell-icon"> <div id="bloc_cc"><a id="cc_link" href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener">
            <span >
                <img id="cc_img" class="cc-50" src="https://mirrors.creativecommons.org/presskit/buttons/88x31/png/by.png"
                    alt="Licence Creative Commons BY">
            </span>
            </a></div>
        </td>
    <td class="cell-text">
        <span id="outLine" class="out-line" > 

                
                &laquo;
                <span id="outTitre" class="quote">Titre de l'&#339;uvre</span>
                &raquo;,&nbsp;
                &copy; 
                <span id="outCreateurs" class="quote">Cr√©ateurs</span>,&nbsp;
                <span id="outAnnee">An</span>, est sous licence
                    <a id="outLicenceLink"> <span id="outLicenseText" class="quote">&laquo; Licence √† choisir &raquo;</span></a>,&nbsp;<span id="exception" class="out-line" >sauf indications contraires.</span>
                </span>
            </span><!-- Attrib1 -->

            <span id="AdapTransit" class="quote"> / Adapt√© de : </span>
            <span id="Attrib2">
            <!-- ATTRIBUTION OEUVRE SOURCE -->
                &laquo;
                <span id="outTitre0" class="quote">Titre de l&#339;uvre</span>
                    &raquo;,&nbsp;
                    &copy; &nbsp;
                    
                    <span id="outCreateurs0" class="quote">Cr√©ateurs</span>,&nbsp;
                    <span id="outAnnee0">An</span>,
                    <!-- <span id="est">&nbsp;est&nbsp;</span> -->
                    sous licence&nbsp;
                        <a id="outLicenceLink0"> <span id="outLicenseText0" class="quote">&laquo; Licence √† choisir &raquo;</span></a>. 
            </span>

            <span id="Attrib3"><span id="AdjustOutPrez" class="quote"><br> / <strong>Ajustements effectu√©s : </strong><span id="AdjustOut" class="quote"></span></span></span>
            <span id="Attrib4"><span id="AdaptOutPrez" class="quote"><br> / <strong>Adaptations effectu√©es : </strong><span id="AdaptOut" class="quote"></span></span></span>
            <!-- <span id="Attrib3"><br> / <strong>Ajustementss effectu√©es : </strong><span id="AdjustOut" class="quote">test    </span></span> -->




    </td>
  </tr>
</table>



                
        </div> 
        <!-- <br> -->
<div class="adroite">
<button id="btnCopier1" class="bouton-moyen" onclick="copierDansClipboard('Attributions')";>Copier</button>
</div>
   <!--  ********************************************************** -->
    <!--*********************       APA      ***********************-->
   <div id="CitBloc">
    
        <span class="title-out" id="CitBlocTitre"><p><br></p> Comment citer cette oeuvre en style APA&nbsp;:<p></p></span>
    <table class="cc-table">
  <tr>
    <td>
            <span id="outCreateursCit" class="quote">Cr√©ateurs</span>.&nbsp;
            (<span id="outAnneeCit">An</span>).&nbsp;     
            <span id="outTitreCit" class="quote">Titre de l'&#339;uvre</span>.&nbsp;
            <span id="outEditCit" class="quote">Organisation √©ditrice.</span>
            <!-- .&nbsp;             -->
        <a id="outLinkCit"> <span id="outLinkCitText" class="quote">DOI ou URL.</span></a>
        <!-- .&nbsp;  -->
        Sous licence&nbsp;<a id="outLicenceLinkCit"> <span id="outLicenseTextCit" class="quote">&laquo; Licence √† choisir &raquo;</span></a>.
       
          </td>
  </tr>
    </table>
    </div>


<!-- <br> -->
<div class="adroite">
<button class="bouton-moyen" id="btnCopier2" onclick="copierDansClipboard('CitBloc')";>Copier</button>
</div>


<p></p><p></p>
<div style="margin-top: 300px;"></div>
<div class="bloc-typeRef">
  <div class="headerRef">
    <div class="title-out">R√©f√©rences et compl√©ments</div>
    <button id="toggleRef" class="toggle-btnRef">+</button>
  </div>

  <div id="ref" class="content" style="display:none;">
    <ul>
      <li><a href="http://Recommended practices for attribution" target="_blank">Recommended practices for attribution (Creative Commons)</a></li>    
      <li><a href="https://www.uottawa.ca/bibliotheque/droit-auteur/quest-ce-que-droit-auteur/comment-attribuer-du-contenu-license-creative-commons-pratiques-exemplaires" target="_blank">Comment attribuer du contenu sous license CC (U. Ottawa)</a></li>
      <li><a href="https://www.bda.ulaval.ca/utilisation-libre/oeuvres-sous-licence-creative-commons/" target="_blank">Oeuvres sous licence CC (U. Laval)</a></li>
      <li><a href="https://fabriquerel.org/ressources/licences/" target="_blank">Les licences (fabriqueREL)</a></li>
      <li><a href="https://creativecommons.org/chooser/" target="_blank">Licence Chooser (Creative Commons)</a></li>
      <li><a href="https://creativecommons.org/mission/downloads/" target="_blank">CC icons (Creative Commons)</a></li>
    </ul>
  </div>
</div>


<div><!-- Bouton discret -->
<button id="aproposBtn" class="apropos-btn">√Ä propos</button>

<!-- Licence GNU GPLv3 - Fen√™tre modale cach√©e au d√©part  -->
<div id="aproposModal" class="modal">
  <div class="modal-content">
    <span id="closeModal" class="close">&times;</span>
    <h2>Licence GNU GPLv3</h2>
    <pre>
Copyright (C) 2026 Claude Potvin (https://www.linkedin.com/in/claude-potvin-b506a471/)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program. If not, see &lt;https://www.gnu.org/licenses/&gt;.


Note pour les francophones : 
Pour des raisons l√©gales, cette licence n'est pour le moment disponible
qu'en anglais.
    </pre>
  </div>
</div>

</div>

</div> <!-- col2-->

<!-- ************************************************************ -->


  <script>
//ouvre √âtpe 1 par d√©faut : Originale / Tab1
const btn = document.querySelector('.tab-buttons button[data-tab="tab1"]'); // quel tab?

fonctionOriginale();

function updateURLTitreCitation() {

    const optionTexte = document.getElementById('titre');
  //  const outLinkCit = document.getElementById('outLinkCit'); // RÔøΩcupÔøΩre le libellÔøΩ       
    //if  (LeType === "originale" || boutonActif.id === "tab2"){
    //    if (LeType !== "ajustee" && boutonActif.id === "btn2"){          
        outLinkCit.textContent = optionTexte;
        if (valeur0) {
            outLinkCit.href = licences[valeur0].url || "";
        //alert(url);// rend le titre cliquable
            outLinkCit.target = "_blank";
            outLinkCit.rel = "noopener noreferrer";
        } else {
            outLinkCit.removeAttribute('href');  // pas de lien si URL vide
        }

   const urlTitre = document.getElementById('titre_url').value.trim();
       let lienT = "";   
      if (regexURL.test(urlTitre)) {
        // Priorit√© √† l‚ÄôURL
        lienT=urlTitre;
      } 
      else {
        if (urlTitre) alert("Oeuvre : URL non conforme");
        return;
      }
      const outLinkCit = document.getElementById('outLinkCit'); // RÔøΩcupÔøΩre le libellÔøΩ 
      outLinkCit.innerHTML = `<a href="${lienT}" target="_blank">${urlTitre}</a>`;
      
      //activation URL citation APA
     // const outLinkCit = document.getElementById('outLinkCit'); // RÔøΩcupÔøΩre le libellÔøΩ       
    //    if  (getSelectedType() !== "ajustee"){
       // if  (zone() === 1) {
     outLinkCit.innerHTML = `<a href="${lienT}" target="_blank">${lienT}</a>`;


}    
 
function AfficheLicence() {
  const select = document.getElementById("choix_lic");
  const valeur = select.value;                          // num√©ro choisi
  const optionTexte = select.options[select.selectedIndex].text; // libell√©

  const outLicenceLink = document.getElementById("outLicenceLink");
  const outLicenceLinkCit = document.getElementById("outLicenceLinkCit");

  // Mettre √† jour le texte des deux liens
  [outLicenceLink, outLicenceLinkCit].forEach(link => {
    link.textContent = optionTexte;
  });

  if (valeur) {
    // Ici tu peux utiliser un tableau licences_URL[valeur] si tu veux une vraie URL
    const url = optionTexte || ""; // ‚ö†Ô∏è remplacer par licences_URL[valeur] si disponible

    [outLicenceLink, outLicenceLinkCit].forEach(link => {
      link.href = url;
      link.target = "_blank";
      link.rel = "noopener noreferrer";
    });
  } else {
    [outLicenceLink, outLicenceLinkCit].forEach(link => {
      link.removeAttribute("href");
    });
  }
}

function AfficheLicence0() {
  const select = document.getElementById("choix_lic0");
  const valeur = select.value;                          // num√©ro choisi
  const optionTexte = select.options[select.selectedIndex].text; // libell√©

  const outLicenceLink0= document.getElementById("outLicenceLink0");
  const outLicenceLinkCit0 = document.getElementById("outLicenceLinkCit0");

  // Mettre √† jour le texte des deux liens
  [outLicenceLink0].forEach(link => {
    link.textContent = optionTexte;
  });

  if (valeur) {
    // Ici tu peux utiliser un tableau licences_URL[valeur] si tu veux une vraie URL
    const url = optionTexte || ""; // ‚ö†Ô∏è remplacer par licences_URL[valeur] si disponible

    [outLicenceLink0].forEach(link => {
      link.href = url;
      link.target = "_blank";
      link.rel = "noopener noreferrer";
    });
  } else {
    [outLicenceLink0].forEach(link => {
      link.removeAttribute("href");
    });
  }
}
//Toggle Ref
document.getElementById("toggleRef").addEventListener("click", function() {
  const ref = document.getElementById("ref");
  if (ref.style.display === "none" || ref.style.display === "") {
    ref.style.display = "block";
    this.textContent = "‚Äì"; // change le + en ‚Äì
  } else {
    ref.style.display = "none";
    this.textContent = "+"; // remet le +
  }
});

// BOUTON √Ä PROPOS LICENCE GNU GPLv3

const modal = document.getElementById("aproposModal");
const btnAP = document.getElementById("aproposBtn");
const close = document.getElementById("closeModal");

btnAP.addEventListener("click", () => {
  modal.style.display = "block";
});
close.addEventListener("click", () => {
  modal.style.display = "none";
});
window.addEventListener("click", (event) => {
  if (event.target === modal) {
    modal.style.display = "none";
  }
});


//Aide &
const trigger = document.querySelector('.tooltip-trigger');
const tooltip = document.getElementById('tooltip');

trigger.addEventListener('click', (e) => {
  const rect = trigger.getBoundingClientRect();
  tooltip.style.left = rect.left + 'px';
  tooltip.style.top = rect.bottom + 'px';
  tooltip.style.display = tooltip.style.display === 'block' ? 'none' : 'block';
});

document.addEventListener('click', (e) => {
  if (!trigger.contains(e.target) && !tooltip.contains(e.target)) {
    tooltip.style.display = 'none';
  }
});


function majLicence() {
    const select = document.getElementById("choix_lic");
    const value = select.value;

    const link = document.getElementById("cc_link");
    const img = document.getElementById("cc_img");

    if (!value || !licences[value]) {
        link.href = "#";
        img.src = "";
        img.alt = "";
        return;
    }

    const { url, icon } = licences[value];

    link.href = url;
    img.src = icon;
    img.alt = `Licence Creative Commons ${select.options[select.selectedIndex].text}`;
}






</script>

<!-- *******************BOITE DE SAISIE DYNAMIQUE POUR LES AUTEURS********************************************** -->

<!-- Import SortableJS -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

<script>
// ------------------------------------------------------------
// Met √† jour les sorties pour une table donn√©e
// ------------------------------------------------------------
function majSorties(tableId) {
  const table = document.getElementById(tableId);
  const rows = table.querySelectorAll("tbody tr");

  let createursItems = [];
  let createursAPAItems = [];

  rows.forEach(row => {
    const nom = row.cells[0].querySelector("input").value.trim();
    const prenomInput = row.cells[1].querySelector("input");
    const prenom = prenomInput.value.trim();
    const orgChecked = row.cells[2].querySelector("input[type=checkbox]").checked;

    if (orgChecked && nom) {
      createursItems.push(nom);
      createursAPAItems.push(nom);
    } else if (nom) {
      if (prenom) {
        createursItems.push(`${prenom} ${nom}`);

        const parties = prenom.split(/\s+/);
        const initiales = parties.map(p =>
          p.includes("-")
            ? p.split("-").map(sub => sub.charAt(0).toUpperCase() + ".").join("-")
            : p.charAt(0).toUpperCase() + "."
        ).join(" ");

        createursAPAItems.push(`${nom}, ${initiales}`);
      } else {
        createursItems.push(nom);
        createursAPAItems.push(nom);
      }
    }
  });

  function formatListe(items) {
    if (items.length === 0) return "";
    if (items.length === 1) return items[0];
    return items.slice(0, -1).join(", ") + " et " + items[items.length - 1];
  }

  document.getElementById("createurs_" + tableId).value = formatListe(createursItems);
  document.getElementById("createursAPA_" + tableId).value = formatListe(createursAPAItems);
}

// ------------------------------------------------------------
// Ajoute une ligne dans une table donn√©e
// ------------------------------------------------------------
function ajouterLigne(tableId) {
  const table = document.getElementById(tableId);
  const tbody = table.querySelector("tbody");
  const rows = Array.from(tbody.querySelectorAll("tr"));

  rows.forEach(row => row.cells[0].querySelector("input").classList.remove("highlight"));

  // Validation : NOM obligatoire (Pr√©nom facultatif)
  for (let row of rows) {
    const nomInput = row.cells[0].querySelector("input");
    const nom = nomInput.value.trim();
    const orgChecked = row.cells[2].querySelector("input[type=checkbox]").checked;

    if (!nom && !orgChecked) {
      nomInput.classList.add("highlight");
      return;
    }
    if (orgChecked && !nom) {
      nomInput.classList.add("highlight");
      return;
    }
  }

  // Supprime le + visuel de la derni√®re ligne
  const lastRow = tbody.lastElementChild;
  if (lastRow) {
    const lastAddCell = lastRow.querySelector(".add-row");
    if (lastAddCell) lastAddCell.textContent = "";
  }

  //********************************************************
  const newRow = document.createElement("tr");
  newRow.classList.add("fade-in");
  newRow.innerHTML = `
    <td><input type="text"></td>
    <td><input type="text"></td>
    <td><input type="checkbox"></td>
    <td class="add-row">+</td>
  `;
  tbody.appendChild(newRow);

  newRow.querySelectorAll("input").forEach(input => {
    input.addEventListener("input", () => majSorties(tableId));
    input.addEventListener("click", () => majSorties(tableId));
    input.addEventListener("input", () => input.classList.remove("highlight"));
  });

  const checkbox = newRow.querySelector("input[type=checkbox]");
  const prenomInput = newRow.cells[1].querySelector("input");
  checkbox.addEventListener("change", e => {
    if (e.target.checked) {
      prenomInput.value = "";
      prenomInput.disabled = true;
      prenomInput.classList.add("disabled");
    } else {
      prenomInput.disabled = false;
      prenomInput.classList.remove("disabled");
    }
    majSorties(tableId);
  });

  repositionnerPlus(tableId);
  majSorties(tableId);
}

// ------------------------------------------------------------
// Replace le + sur la derni√®re ligne (visuel seulement)
// ------------------------------------------------------------
function repositionnerPlus(tableId) {
  const table = document.getElementById(tableId);
  const tbody = table.querySelector("tbody");
  const rows = Array.from(tbody.querySelectorAll("tr"));

  rows.forEach(row => {
    const addCell = row.querySelector(".add-row");
    if (addCell) addCell.textContent = "";
  });

  const lastRow = tbody.lastElementChild;
  if (lastRow) {
    const addCell = lastRow.querySelector(".add-row");
    if (addCell) addCell.textContent = "+";
  }
}

// ------------------------------------------------------------
// Initialise une table
// ------------------------------------------------------------
function initTable(tableId) {
  const table = document.getElementById(tableId);
  const tbody = table.querySelector("tbody");

  table.querySelectorAll("input").forEach(input => {
    input.addEventListener("input", () => majSorties(tableId));
    input.addEventListener("click", () => majSorties(tableId));
    input.addEventListener("input", () => input.classList.remove("highlight"));
  });

  table.querySelectorAll("input[type=checkbox]").forEach(checkbox => {
    const row = checkbox.closest("tr");
    const prenomInput = row.cells[1].querySelector("input");
    checkbox.addEventListener("change", e => {
      if (e.target.checked) {
        prenomInput.value = "";
        prenomInput.disabled = true;
        prenomInput.classList.add("disabled");
      } else {
        prenomInput.disabled = false;
        prenomInput.classList.remove("disabled");
      }
      majSorties(tableId);
    });
  });

  // üîπ Event delegation: on ne r√©agit que si le + est visible
  tbody.addEventListener("click", e => {
    const cell = e.target.closest(".add-row");
    if (!cell) return;
    if (!cell.textContent.includes("+")) return; // pas de + ‚Üí ne rien faire
    ajouterLigne(tableId);
  });

  new Sortable(tbody, {
    animation: 150,
    onEnd: () => {
      majSorties(tableId);
      repositionnerPlus(tableId);
    }
  });

  repositionnerPlus(tableId);
  majSorties(tableId);
}

// ------------------------------------------------------------
// Initialisation automatique de toutes les tables
// ------------------------------------------------------------
document.querySelectorAll(".table-auteurs").forEach(table => {
  initTable(table.id);
});
</script>


    </div>
    
</div><!--CONTAINER-->

  
</body>
</html>
