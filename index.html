
<!DOCTYPE html>
<!-- G√âN√âRATEUR D'ATTRIBUTION DE LICENCES CREATIVE COMMONS ET G√âN√âRATEUR DE CITATIONS APA
v beta-b  - 2026.02.13
Copyright (C) 2026 Claude Potvin (https://www.linkedin.com/in/claude-potvin-b506a471/)
# Assistance √† la programmation r√©alis√©e avec un robot conversationnel (Microsoft Copilot)
Lien fonctionnel : https://claudepotvin.github.io/gencc/
Sources : https://github.com/claudepotvin/gencc 

Cette appli demande √† l'utilisateur de faire un choix selon 3 possibilit√©s selon que l'oeuvre est:
Originale : 1 onglet √† remplir
Adapt√©e (Nouvelle oeuvre d√©riv√©e) : 2 onglets √† remplir
Ajust√©e : 1 onglet √† remplir 

Onglet 1 : pas de num√©ro dans les variables (oeuvre cr√©√©e ou ajust√©e)
Onglet 2 : num√©ro 0 ajout√© dans les variables (oeuvre d'origine)

V√©rifie l'ad√©quation de la licence d'une oeuvre adapt√©e.

*******************************************************
LICENCE
Copyright (C) 2026 Claude Potvin (https://www.linkedin.com/in/claude-potvin-b506a471/)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program. If not, see &lt;https://www.gnu.org/licenses/&gt;.


Note pour les francophones : Pour des raisons l√©gales, cette licence n'est pour le moment disponible qu'en anglais.

***********************************************************
-->

<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Attribution d'une &#339;uvre et citation APA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
 
  <!-- Flatpickr CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/fr.css">
 
 <style>
  :root { --border:#d0d7de; --muted:#555; --brand:#0078D7; }
  body { font-family: Arial, sans-serif; margin: 24px; line-height: 1.45; }

.highlight { background-color: yellow; }

.container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  position: relative;
  border-top: 2px solid #0078D7;
}

.container::before {
  content: "";
  position: absolute;
  top: 2px;   /* d√©marre sous la ligne horizontale */
  bottom: 0;
  left: 50%;
  border-left: 1px solid #0078D7;
}

.panel { border: 0px solid var(--border); padding: 0 18px; }

  h1 { font-size: 1.4rem; margin: 0 0 12px; }
  h2 { margin: 0 0 10px; font-size: 1.1rem; letter-spacing: 0.02em; }
  .title-out { margin-top: 6px; font-weight: bold; font-size: 1rem; display: none; }/* cach√© au d√©part */
  label { display:block; margin-top: 10px; font-weight: 600; }
  /* input[type="text"], input[type="url"], input[type="number"] {
    width: 80%; padding: 8px 10px; margin-top: 6px;
    border: 1px solid var(--border); border-radius: 6px;
  } */

input[type="text"],
input[type="url"],
input[type="number"] {
    width: 85%;
    padding: 8px 10px;
    margin-top: 6px;
    border: 1px solid var(--border);
    border-radius: 6px;
    font-size: 15px;
    box-sizing: border-box;
}

  .help { color: var(--muted); font-size: 0.9em; margin-top: 6px; }
  .out-line { margin-top: 8px; font-size: 1rem; }
  .out-subline { margin-top: 6px; font-size: 0.95em; color: var(--muted); }
  .out-subline a { color: var(--brand); word-break: break-all; }
  .license-line { margin-top: 4px; font-size: 0.95em; color: var(--muted); }
  .license-line a { color: var(--brand); }
  .quote { white-space: pre-wrap; }
  .separator { margin: 0 6px; color: #888; }

  /* ‚úÖ Bloc Type d‚Äô≈ìuvre */
    .bloc-type {
        background-color: #f0f0f0;
        padding: 10px 15px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        gap: 20px;
        font-family: sans-serif;
        justify-content: space-between; 
    }
        .bloc-type2 {
        background-color: #e0d9d9;
        padding: 10px 15px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        gap: 20px;
        font-family: sans-serif;
        justify-content: space-between; 

    }

  .radio-group {
    display: flex;
    gap: 20px;
  }

  /* ‚úÖ AJOUT : Styles pour les onglets */
  .tabs {
    border: 0px solid var(--border);
    border-radius: 8px;
    padding: 12px;
    /* border-top: 2px solid #0078D7;  */
  }

  .tab-buttons {
    display: flex;
    gap: 10px;
    margin-bottom: 12px;
    margin-top: 12px;
    margin-right: 12px;
  }

.tab-buttons button {
  padding: 6px 12px;
  border: 1px solid #0078D7;   /* contour bleu par d√©faut */
  background: #f7f7f7;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.95rem;
  color: #0078D7;              /* texte bleu pour coh√©rence */
}

.tab-buttons button.active-tab {
  background: var(--brand);
  color: white;
  border-color: var(--brand);  /* contour prend la couleur de la marque quand actif */
}
  .active-tab {
  background: var(--brand);
  color: white;
  border-color: var(--brand);
  font-weight: bold;
}
  .tab-content {
    border: 0px solid var(--border);
    background: #fafafa;
    padding: 12px;
    border-radius: 6px;
    display: none;
  }
  #boutons,#remplir, #generer {
  display: none; /* cach√© au d√©part */

 table { border-collapse: collapse; margin-bottom: 1em; width: 100%; }
  th, td { border: 1px solid #ccc; padding: 6px; text-align: center; table-layout: auto;}
  /*td input[type="text"] { width: 95%; max-width: 100%; box-sizing: border-box;  inclut padding/border dans la largeur */}
 td input[type="text"] {
  width: 100%;          /* occupe toute la cellule */
  max-width: 100%;      /* ne d√©passe jamais */
  box-sizing: border-box; /* inclut padding/border dans la largeur */
}
  td input[type="checkbox"] { display: block; margin: auto; }
  .add-row { font-size: 24px; font-weight: bold; cursor: pointer; color: green; }
  textarea { width: 100%; height: 60px; }
  .disabled { background-color: #eee; color: #666; }


/* td input[type="text"] {
  width: 100%;
  max-width: 100%;
  box-sizing: border-box; /* inclut padding/border dans la largeur */
 */

/*table {
 // table-layout: auto;  largeur dynamique pour les colonnes */


th, td {
  border: 1px solid #ccc;
  padding: 6px;
}

/* Les deux premi√®res colonnes s'√©tendent automatiquement */
td:nth-child(1),
td:nth-child(2),
th:nth-child(1),
th:nth-child(2) {
  width: auto;
}

/* Les deux derni√®res colonnes centr√©es */
td:nth-child(3),
td:nth-child(4),
th:nth-child(3),
th:nth-child(4) {
    text-align: center;
    width: 80px;   /* ou 60px selon ton go√ªt */
}



.affichageRez {display: none;} /* cach√© au d√©part */

.explication {
/*   grid-column: 2;   : place le bloc dans la colonne de droite */
  margin-left: auto;   /*  place le bloc dans la colonne de droite   */ 
  padding: 6px 12px; 
  background-color: #f9f9f4;      /* fond tr√®s clair */
  border: 1px solid #dcd7c9;      /* bordure douce */
  border-radius: 4px;
  font-weight: 540;               /* entre normal et bold */
  color: #020202;                 /* gris fonc√©, lisible mais pas agressif */
  max-width: 1000px;
}

.droite { display: flex; justify-content: flex-end; }
.bouton-grand { 
    font-size: 1.0rem; 
    font-weight: normal; 
    padding: 12px 24px; 
    border-radius: 6px; 
    background-color: #0078d4; 
    color: white; 
    border: none; 
    cursor: pointer; 
}

.bouton-moyen { 
    font-size: 1.0rem; 
    font-weight: normal; 
    padding: 12px 24px; 
    border-radius: 5px; 
    background-color: #0078d4; 
    color: white; 
    border: none; 
    cursor: pointer; 
    margin-left: auto;
    display: none;
}

 .bouton-grand:hover { background-color: #005fa3; }  
 #titre { width: auto; }
 /* .col2 { border-left: 2px solid #0078D7; padding-left: 16px; margin-left: 8px; } */
 /* .col1 { border-top: 2px solid #0078D7; // ligne en haut  */
    /* padding-left: 16px; margin-left: 8px; } */
  .col2 { /*border-left: 2px solid #0078D7;  ligne √† gauche */  
    /* border-top: 2px solid #0078D7; /* ligne en haut */  
     padding-left: 16px; margin-left: 16px; padding-top: 16px;} */
/* .bouton-grand { font-size: 1.2rem; font-weight: bold; padding: 10px 20px; } */

/* p { font-size: 1.5em; /* agrandit la police */  */

.disabled { background: #eee; }

  /* Animation subtile lors de l‚Äôajout */
  .fade-in {
    animation: fadeSlide 0.35s ease-out;
  }
  @keyframes fadeSlide {
    from { opacity: 0; transform: translateY(-4px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .decale {
  margin-left: 1cm; /* d√©cale de 1 cm vers la droite */
}
 
#titre { width: 89%; }
#annee { width: 20%; }
/* background-color: lightyellow;  */


.form-flex {
  display: flex;
  gap: 20px;
}

.form-flex > div {
  flex: 1; /* chaque bloc prend la moiti√© */
  flex: 0 0 auto; /* emp√™che l‚Äôexpansion */
}

/* ‚úÖ Responsive */
@media (max-width: 600px) {
  .form-flex {
    flex-direction: column; /* empile les blocs */
  }
}

.cache {display: none;}
#monId:empty {
  display: none;
}
.adroite {
        display: flex;
        text-align: right;}

/* pour toggle references */

.bloc-typeRef {
  border: 1px solid #ccc;
  padding: 10px;
  max-width: 600px;
}

.headerRef {
  display: flex;
  justify-content: space-between; /* titre √† gauche, bouton √† droite */
  align-items: center;
  margin-bottom: 10px;
width: 100%;
 
  bottom: 0;       /* colle en bas */
  left: 0;

}

.footer {
  position: fixed;/* colle en bas */
  bottom: 0;       /* colle en bas */
  left: 0;
  width: 100%;     /* occupe toute la largeur */
  background: #eee;
  text-align: center;
  padding: 10px;
}


.titleRef {
  font-weight: bold;
  font-size: 1.2em;
}

.toggle-btnRef {
  font-size: 1.5em;       /* plus gros */
  color: blue;            /* texte bleu */
  background: none;       /* pas de fond */
  border: none;           /* pas de bordure */
  cursor: pointer;
}

/*  D√âBUT affichage licence GNU */
/* Bouton discret fix√© en bas √† droite */
.apropos-btn {  
  position: absolute;/* plus gros */
  bottom: 15px;
  right: 20px;
  font-size: 0.9em;
  color: #0066cc;
  background: none;
  border: 1px solid #0066cc;
  border-radius: 4px;
  padding: 6px 12px;
  cursor: pointer;
  opacity: 0.8;
}
.apropos-btn:hover {
  opacity: 1;
  background: #f0f8ff;
}

.tooltip {
  position: absolute;
  background: #333;
  color: #fff;
  padding: 8px 10px;
  border-radius: 4px;
  font-size: 0.9em;
  display: none;
  max-width: 220px;
  z-index: 1000;
}


.cc-table {
  border-collapse: collapse;
  width: 100%;
}

.cc-table td {
  border: 1px solid #ccc;
  vertical-align: middle;
  padding: 10px;
}

/* Colonne 1 : largeur auto selon l‚Äôimage */
.cell-icon {
  width: 1%;
  white-space: nowrap;
  text-align: center;
}

/* Image r√©duite √† 50% (88√ó31 ‚Üí 44√ó16) */
.cc-50 {
  width: 88px;
  height: 31px;
  display: block;
  margin: 0 auto;
  
}


/* Colonne 2 : align√©e √† gauche, centr√©e verticalement */
.cell-text {
  text-align: left;
}



/* Image r√©duite √† 50‚ÄØ% (88√ó31 ‚Üí 44√ó16) 
.cc-50 { width: 44px; height: 16px; display: block; margin: 0 auto; }*/ 

/* Fen√™tre modale */
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background-color: rgba(0,0,0,0.5);
}
.modal-content {
  background: #fff;
  margin: 5% auto;
  padding: 20px;
  width: 80%;
  max-width: 700px;
  border-radius: 6px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  overflow-y: auto;
  max-height: 80%;
}
.close {
  float: right;
  font-size: 1.5em;
  cursor: pointer;
  color: #333;
} /* */
.close:hover {
  color: red;
}

.ok  { background: #d4f8d4; border: 1px solid #4caf50; color: #1b5e20; }
.warn { background: #d4f8d4; border: 1px solid #c9a400; color: #ce6504; /* jaune orang√© lisible */ }
.err { background: #ffd4d4; border: 1px solid #d40000; color: #a30000; }

/* ****FIN GNU ************** */


/* Calendrier Flatpickr CSS */
 .container_cal {
      flex: 0 0 auto; /* garde le bloc compact */ 
      margin: 0 auto;
      background: white;
      padding: 5px 10px;
      border-radius: 8px;
      max-width: 150px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    label {
      font-weight: bold;
      display: block;
      margin-bottom: 8px;
    }
    /* input[type="text"] {
      padding: 4px;
      font-size: 16px;
      width: 100%;
      box-sizing: border-box;
    } */
    button {
      margin-top: 15px;
      padding: 10px 15px;
      font-size: 16px;
      cursor: pointer;
    }


.label-jour-texte {
    font-size: 0.85rem;
    color: #777;
}

.soustexte {
    font-size: 0.85rem;
    color: #777;
    text-align: center;
}

.col1 {
    margin-left: -0.5cm;
}

select {
    font-size: 15px;
}


/* ************************** */
/* Alert box */
/* Conteneur g√©n√©ral */
.alert-box {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  max-width: 90%;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  z-index: 10000;
  background: #fff;
  border: 2px solid #444;
  font-size: 16px;
}

/* Variantes selon le type */
.alert-ok {
  border-color: #3a8f3a;
}

.alert-warn {
  border-color: #d8a400;
}

.alert-err {
  border-color: #c62828;
}

/* Contenu */
.alert-content {
  margin-bottom: 20px;
}

/* Bouton */
.alert-close {
  padding: 8px 16px;
  font-size: 14px;
  cursor: pointer;
  border: none;
  background-color: #4caf50;
  color: #fff;
  border-radius: 4px;
}
/* ************************** */

.hidden {
    display: none;
}

</style>


  <script>
    // Encodage des caractÔøΩres FR + & en entitÔøΩs HTML numÔøΩriques
    function encodeFrenchEntities(str) {
      if (!str) return '';
      const map = {
        '&':'&#38;', 'ÔøΩ':'&#224;','ÔøΩ':'&#226;','ÔøΩ':'&#228;','ÔøΩ':'&#231;','ÔøΩ':'&#233;','ÔøΩ':'&#232;','ÔøΩ':'&#234;','ÔøΩ':'&#235;',
        'ÔøΩ':'&#238;','ÔøΩ':'&#239;','ÔøΩ':'&#244;','ÔøΩ':'&#246;','ÔøΩ':'&#249;','ÔøΩ':'&#251;','ÔøΩ':'&#252;','ÔøΩ':'&#255;','ÔøΩ':'&#339;','ÔøΩ':'&#230;',
        'ÔøΩ':'&#192;','ÔøΩ':'&#194;','ÔøΩ':'&#196;','ÔøΩ':'&#199;','ÔøΩ':'&#201;','ÔøΩ':'&#200;','ÔøΩ':'&#202;','ÔøΩ':'&#203;','ÔøΩ':'&#206;','ÔøΩ':'&#207;',
        'ÔøΩ':'&#212;','ÔøΩ':'&#214;','ÔøΩ':'&#217;','ÔøΩ':'&#219;','ÔøΩ':'&#220;','ÔøΩ':'&#376;','ÔøΩ':'&#338;','ÔøΩ':'&#233;'
      };
	  //'ÔøΩ':'&#198;'
      return str.replace(/[&ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ‹üÔøΩÔøΩ]/g, ch => map[ch] || ch);
    }

  const licences = {
   "1": {
    url: "https://creativecommons.org/publicdomain/zero/1.0/deed.fr",
    //icon: "http://mirrors.creativecommons.org/presskit/buttons/88x31/png/cc-zero.png"
    icon: "https://licensebuttons.net/p/zero/1.0/88x31.png"
  },
  "2": {
    url: "https://creativecommons.org/licenses/by/4.0/deed.fr",
    //icon: "https://mirrors.creativecommons.org/presskit/buttons/88x31/png/by.png"
    icon: "https://licensebuttons.net/l/by/3.0/88x31.png"
  },
  "3": {
    url: "https://creativecommons.org/licenses/by-sa/4.0/deed.fr",
    //icon: "https://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-sa.png"
    icon: "https://licensebuttons.net/l/by-sa/3.0/88x31.png"
  },
  "4": {
    url: "https://creativecommons.org/licenses/by-nc/4.0/deed.fr",
    //icon: "https://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-nc.png"
    icon: "https://licensebuttons.net/l/by-nc/3.0/88x31.png"
  },
  "5": {
    url: "https://creativecommons.org/licenses/by-nc-sa/4.0/deed.fr",
    //icon: "https://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-nc-sa.png"
    icon: "https://licensebuttons.net/l/by-nc-sa/3.0/88x31.png"
  },
  "6": {
    url: "https://creativecommons.org/licenses/by-nd/4.0/deed.fr",
   // icon: "https://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-nd.png"
    icon: "https://licensebuttons.net/l/by-nd/3.0/88x31.png"
  },
  "7": {
    url: "https://creativecommons.org/licenses/by-nc-nd/4.0/deed.fr",
    //icon: "https://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-nc-nd.png"
    icon: "https://licensebuttons.net/l/by-nc-nd/3.0/88x31.png"
  }
};


    // Regex simples mais efficaces pour tester email et URL
    const regexURL = /^(https?:\/\/)[\w.-]+(\.[a-z]{2,})(\/.*)?$/i;
    const regexEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    let boutonActif = 1; //1=ajustee, 2=adaptee-tab1, 3=adaptee-tab3, 4=ajuteee

    const remplirTextBrut = "Remplir les champs du formulaire pour g&#233;n&#233;rer un libell&#233; d'attribution CC conforme."
    const remplirTexte2 = "Remplir les champs des <strong>2 onglets du formulaire</strong> pour g&#233;n&#233;rer un libell&#233; d'attribution CC conforme."

   
    //FONCTIONS DES 3 OPTIONS

function afficherEncadre() {
    document.querySelector('.container').style.display = 'grid';
    document.getElementById('generer').style.display = 'flex'; ;
    document.getElementById('remplir').style.display = 'flex'; ;
}

function fonctionOriginale() {
    ShowTitles();
    //alert("Fonction pour ≈ìuvre originale ex√©cut√©e");
    document.getElementById('boutons').style.display = 'flex';    
    //openTab('tab1', null);
    //alert("goo");
   //alert (btn.id);
    const btn = document.querySelector('.tab-buttons button[data-tab="tab1"]'); // quel tab?
    //alert (btn.id);
    openTab('tab1', btn);
   // alert (btn.id);
    afficherEncadre();
    document.getElementById("btn1").style.display = ""; //bouton visible
    document.getElementById("btn2").style.display = "none";//bouton invisible
    document.getElementById('remplir').innerHTML= remplirTextBrut;
    AfficheAdjustAdapt();
    document.getElementById("Explications").textContent = "Vous √™tes titulaire(s) des droits d'auteur sur cette oeuvre parce qu'elle est totalement originale."; 
    }

function AfficheAdjustAdapt() {
  const z = zone();
  //const z = 1;
//alert(z);
 // table de correspondance : [Attrib3, Attrib4, blocAdjustIn, blocAdaptIn, AdapTransit, Attrib2]
// "Attrib3";//Adjust
// "Attrib4";//Adapt
// "blocAdjustIn";
// "blocAdaptIn";
// "AdapTransit";
// "Attrib2";//Source


  const displayMap = {
    1: ['none', 'none', 'none', 'none', 'none', 'none'],
    2: ['none', 'flex', 'none', 'flex', 'flex', 'flex'],
    3: ['none', 'flex', 'none', 'flex', 'flex', 'flex'],
    4: ['flex', 'none', 'flex', 'none', 'none', 'none']
  };

  const ids = ["Attrib3", "Attrib4", "blocAdjustIn", "blocAdaptIn", "AdapTransit", "Attrib2"];

  if (displayMap[z]) {
    ids.forEach((id, i) => {
      const el = document.getElementById(id);
      if (el) el.style.display = displayMap[z][i];
    });
  }
}

    function fonctionAdaptee() {
        ShowTitles();
    // alert("Fonction pour ≈ìuvre adapt√©e ex√©cut√©e");
    document.getElementById("boutons").style.display = "flex";        
    const btn = document.querySelector('.tab-buttons button[data-tab="tab1"]');
    openTab('tab1', btn);
    afficherEncadre();
    document.getElementById("btn1").style.display = ""; //bouton visible
    document.getElementById("btn2").style.display = "";//bouton visible
    document.getElementById('remplir').innerHTML= remplirTexte2;
    AfficheAdjustAdapt();            
    document.getElementById("Explications").textContent ="Parce que vous avez modifi√© une oeuvre de fa√ßon substantielle,vous √™tes titulaire(s) des droits d'auteur sur la nouvelle oeuvre. Vous devez fournir les donn√©es sur cette oeuvre et sur l'oeuvre d'origine, et pr√©ciser les adaptations effectu√©es.";    
}

    function fonctionAjustee() {
        ShowTitles();
    //   alert("Fonction pour ≈ìuvre ajust√©e ex√©cut√©e");
    document.getElementById("boutons").style.display = "flex";
    //alert ("test");
    const btn = document.querySelector('.tab-buttons button[data-tab="tab2"]');
    afficherEncadre(); 
    
    openTab('tab1', btn);   //affiche l'onglet de l'oeuvre originales
    document.getElementById("btn1").style.display = "none"; //bouton invisible
    document.getElementById("btn2").style.display = "";//bouton visible   
    document.getElementById('remplir').innerHTML= remplirTextBrut;
    AfficheAdjustAdapt();         
    document.getElementById("Explications").textContent = "Vous n'avez modifi√© que l√©g√®rement une oeuvre, et donc vous n'√™tes pas titulaire(s) des droits d'auteur. Vous devez attribuer l'oeuvre aux auteurs d'origine, et pr√©ciser les ajustements effectu√©s."; 
    document.getElementById("dorigineTitre").style.display = "inline-block";//texte visible  
    document.getElementById("dorigineAuteurs").style.display = "inline-block";//texte visible   
}

function getSelectedType() {
  return document.querySelector('input[name="type"]:checked')?.value;
}

function ShowTitles() {
document.querySelectorAll(".title-out").forEach(el => {
el.style.display = "block";
});
}

function getParamF() {
    const params = new URLSearchParams(window.location.search);
    const f = params.get("f");

    // V√©rifie si f est "1", "2" ou "3"
    if (f === "1" || f === "2" || f === "4") {
        return f;
    }

    // Par d√©faut
    return "1";
}


function zone() {
  //const type = getSelectedType();
  //alert (type);
const param=getParamF(); //"", 1, 2 ou 4
  //if (type === "originale") return 1;

  // if (type === "adaptee") {
    if (param === "2") {
 //   const id = boutonActif?.id;   // safe access
    if (boutonActif.id === "btn1") return "2";
    if (boutonActif.id === "btn2") return "3";
   // return 0;
  }

  //if (type === "ajustee") return 4;
  

  return param;
}


function FormValider(z) {
  ["titre_url", "titre_url0", "createurs_profil", "createurs_profil0"]
    .forEach(id => {
      const el = document.getElementById(id);
      if (el) el.classList.remove("highlight");
    });

  const baseChamps = ["titre", "tabAuteursL1", "dateEvenement", "choix_lic"];
  const baseChamps0 = ["titre0", "tabAuteurs0L1", "annee0", "choix_lic0", "AdaptIn"];
  const champsMap = {
    1: [...baseChamps],
    2: [...baseChamps, "titre0", ...baseChamps0],
    3: [...baseChamps, "titre0", ...baseChamps0],
    4: [...baseChamps, "AdjustIn"]
  };

  let valide = true;
  const champs = (champsMap[z] || []).map(id => document.getElementById(id));

  champs.forEach(champ => {
    if (!champ) return;
    champ.classList.remove("highlight");

    if (!champ.value.trim()) {
      champ.classList.add("highlight");
      valide = false;

      champ.addEventListener("focus", () => champ.classList.remove("highlight"), { once: true });
      champ.addEventListener("input", () => champ.classList.remove("highlight"), { once: true });
    }
  });

  // -----------------------------------------------------

  if (z === 3) {//on est dans Adaptation
  //Si tous les champs du tab 1 sont remplis et qu'au moins 1 champs de l'onglet 2 ne l'est pas, active-le
  //Si tous les champs du tab 2 sont remplis et qu'au moins 1 champs de l'onglet 1 ne l'est pas, active-le
  // -----------------------------------------------------
    const tousBase = baseChamps.every(id => {
        const el = document.getElementById(id);
        return el && el.value.trim();
    });

    const tousBase0 = baseChamps0.every(id => {
        const el = document.getElementById(id);
        return el && el.value.trim();
    });

    const unBaseInvalide = baseChamps.some(id => {
        const el = document.getElementById(id);
        return !el || !el.value.trim();
    });

    const unBase0Invalide = baseChamps0.some(id => {
        const el = document.getElementById(id);
        return !el || !el.value.trim();
    });

    // üî• Condition 1 : tous baseChamps remplis + au moins 1 baseChamps0 vide
    if (tousBase && unBase0Invalide) {
   const btn = document.querySelector('.tab-buttons button[data-tab="tab2"]');
   openTab('tab2', btn);
    }

    // üî• Condition 2 : tous baseChamps0 remplis + au moins 1 baseChamps vide
    if (tousBase0 && unBaseInvalide) {
     const btn = document.querySelector('.tab-buttons button[data-tab="tab1"]');
    openTab('tab1', btn);
    }
    
  }
  // -----------------------------------------------------

  if (!valide) {
    const msg = (z === 1 || z === 4)
      ? "Veuillez remplir tous les champs obligatoires (*)"
      : "Veuillez remplir tous les champs obligatoires (*) dans les 2 onglets";

    setTimeout(() => alert(msg), 0);
  }

  return valide;
}


 //fonctions de G√âN√âRATION
function AfficherAttribCit() {//oeuvre 1
    //alert("coucou")   ;
    afficherDate();
   // const lic_nouv = nettoyerLicence("choix_lic");
   //const lic_orig = nettoyerLicence("choix_lic0");
    

   // alert (lic_orig);
const z=zone();
//alert(z);
    switch (z) {
      //alert (z);
        case "1":
          //alert("cou");
            if (FormValider(1));updateOutput();
            break;
        case "2": 
          //alert("cou");
        case "3":
            //alert("cou");
            if (FormValider(3)) {
                //alert (lic_orig);
                testerCompatLic(3)//v√©rif si la licence de la nouvelle oeuvre est ad√©quate (autoris√©e)
                //alert (lic_orig);
                    updateOutput();
                    updateOutput0();
                
            }
            break;
        case "4":
            if (FormValider(4));updateOutput();
            break;
        default:
            // code if none of the cases match
    } 
}   

function nettoyerLicence(selectId) {
  const select = document.getElementById(selectId);
  const texte = select.options[select.selectedIndex].text;
//alert( texte);
if (texte.includes("public")) {return "PD"}

  return texte
    .replace(/^CC\s*/i, "")     // retire "CC "
    .replace(/\s*4\.0$/i, "");  // retire " 4.0"
}

function testerCompatLic(z) {
    const A = nettoyerLicence("choix_lic0");
    const B = nettoyerLicence("choix_lic"); 
    const res = verifierCompatibilite(A, B);
    AfficherCheckRes(res);
    if (z === 3 && res.type === "err") {
        resetSelect("choix_lic");
        const btn = document.querySelector('.tab-buttons button[data-tab="tab1"]');
        openTab('tab1', btn);//focus sur tab1
    }
  }

    function AfficherCheckRes(res){
    if (!res.msg) return;  // licences compatibles ‚Üí rien √† afficher

    // 2. Suppression d'une alerte pr√©c√©dente
    const oldAlert = document.getElementById('customAlert');
    if (oldAlert) oldAlert.remove();

    // 3. Cr√©ation de l‚Äôalerte (sans style inline)
    const alertBox = document.createElement('div');
    alertBox.id = 'customAlert';
    alertBox.className = `alert-box alert-${res.type}`; 
    alertBox.innerHTML = `
        <div class="alert-content">
            ${res.msg}
        </div>
        <button class="alert-close">Fermer</button>
    `;

    // 4. Gestion du bouton de fermeture
    alertBox.querySelector('.alert-close').onclick = () => alertBox.remove();

    // 5. Injection dans la page
    document.body.appendChild(alertBox);

    return res.type === 'ok';
}

function verifierCompatibilite(licenceA, licenceB) {
  const url = "https://creativecommons.org/faq/#if-i-derive-or-adapt-material-offered-under-a-creative-commons-license-which-cc-licenses-can-i-use:~:text=the%20next%20FAQ.)-,Adapter%E2%80%99s%20license%20chart,-The%20chart%20below";

  // Ordre EXACT des colonnes et lignes selon ton tableau
  const compat = {
    "PD":        { "BY": "V", "BY-NC": "V", "BY-NC-ND": "V", "BY-NC-SA": "V", "BY-ND": "V", "BY-SA": "V", "PD": "V" },
    "BY":        { "BY": "V", "BY-NC": "V", "BY-NC-ND": "V", "BY-NC-SA": "V", "BY-ND": "V", "BY-SA": "V", "PD": "J" },
    "BY-NC":     { "BY": "J", "BY-NC": "V", "BY-NC-ND": "V", "BY-NC-SA": "V", "BY-ND": "J", "BY-SA": "J", "PD": "J" },
    "BY-NC-ND":  { "BY": "",  "BY-NC": "",  "BY-NC-ND": "",  "BY-NC-SA": "",  "BY-ND": "",  "BY-SA": "",  "PD": "" },
    "BY-NC-SA":  { "BY": "",  "BY-NC": "",  "BY-NC-ND": "",  "BY-NC-SA": "V", "BY-ND": "",  "BY-SA": "",  "PD": "" },
    "BY-ND":     { "BY": "",  "BY-NC": "",  "BY-NC-ND": "",  "BY-NC-SA": "",  "BY-ND": "",  "BY-SA": "",  "PD": "" },
    "BY-SA":     { "BY": "",  "BY-NC": "",  "BY-NC-ND": "",  "BY-NC-SA": "",  "BY-ND": "",  "BY-SA": "V", "PD": "" }
  };

  // Validation des entr√©es
 // if (!compat[licenceA] || !compat[licenceA][licenceB]) {
 //   return "Licences inconnues ou non prises en charge.";
 // }

 //alert ('allo2')
  const valeur = compat[licenceA][licenceB];

  if (valeur === "") {
    let msg = `La licence de la nouvelle ≈ìuvre <strong>(CC ${licenceB})</strong> est incompatible avec la licence <strong>(CC ${licenceA})</strong> de l'≈ìuvre d'origine.<br><br>Veuillez choisir une autre licence pour la nouvelle oeuvre. Voir <a href="${url}" target="_blank">cette page</a>.`;
    // üëâ Appliquer la transformation seulement si licenceB = "PD"
    if (licenceB === "PD") {
        msg = remplacerCCPD(msg);
    }
    if (licenceA.includes("ND")) {
        msg =`La licence de la nouvelle ≈ìuvre <strong>(CC ${licenceB})</strong> est incompatible avec la licence <strong>(CC ${licenceA})</strong> de l'≈ìuvre d'origine.<br><br>Vous ne pouvez modifier cette oeuvre pour en cr√©er une nouvelle. Voir <a href="${url}" target="_blank">cette page</a>.`;
    }
    return {
        type: "err",
        msg: msg
    };
  }


  if (valeur === "J") {  
     let msg = `La licence de la nouvelle ≈ìuvre <strong>(CC ${licenceB})</strong> est permise, mais non recommand√©e, par rapport √† la licence <strong>(CC ${licenceA})</strong> de l'≈ìuvre d'origine.<br><br>Voir <a href="${url}" target="_blank">cette page</a>.`     
      // üëâ Appliquer la transformation seulement si licenceB = "PD"
    if (licenceB === "PD") {
        msg = remplacerCCPD(msg);
    }
    return {
      type: "warn",
      msg: msg
    };
 }

  return {
    type: "ok",
    //msg: "Licence de la nouvelle ≈ìuvre compatible avec la licence de l'≈ìuvre d'origine."
    msg: ""
    };
 
}


function remplacerCCPD(msg) {//ajoute le 0 √† CC pour mieur identifier
    return msg.replace(/\bCC\s+PD\b/, "CC0 PD");
}


// Fonction utilitaire : r√©cup√®re la valeur, applique trim et encode
function getEncodedValue(id, defaultText) {
  const el = document.getElementById(id);
  const value = (el?.value || "").trim();
  return encodeFrenchEntities(value || defaultText);
}

// Mapping entr√©e ‚Üí sortie
// Mapping selon z
const mappings = {
  1: [
    { inId: "titre", outId: "outTitre", defaultText: "Titre de l'≈ìuvre" },
    { inId: "createurs_tableAuteurs", outId: "outCreateurs", defaultText: "Cr√©ateurs" },
    { inId: "valJourMois", outId: "outJourMois", defaultText: "Jour Mois" },    
    { inId: "valAnnee", outId: "outAnnee", defaultText: "Ann√©e" },
// Citation
    { inId: "createursAPA_tableAuteurs", outId: "outCreateursCit", defaultText: "Cr√©ateurs" },
    { inId: "valAnnee", outId: "outAnneeCit", defaultText: "Ann√©e" },
    { inId: "valJourMois", outId: "outJourMoisCit", defaultText: "Ann√©e" }, 
    { inId: "titre", outId: "outTitreCit", defaultText: "" },
    { inId: "titre_url", outId: "outLinkCitText", defaultText: "" },    
    { inId: "organ", outId: "outEditCit", defaultText: "" }  
  ],
  2: [
    { inId: "titre", outId: "outTitre", defaultText: "Titre de l'≈ìuvre" },
    { inId: "createurs_tableAuteurs", outId: "outCreateurs", defaultText: "Cr√©ateurs" },
    { inId: "valJourMois", outId: "outJourMois", defaultText: "Jour Mois" }, 
    { inId: "valAnnee", outId: "outAnnee", defaultText: "Ann√©e" },
 //Oeubre d'origine   
    { inId: "titre0", outId: "outTitre0", defaultText: "Titre de l'≈ìuvre" },
    { inId: "createurs_tableAuteurs0", outId: "outCreateurs0", defaultText: "Cr√©ateurs" },
    { inId: "annee0", outId: "outAnnee0", defaultText: "Ann√©e" },
// Citation
   { inId: "createursAPA_tableAuteurs", outId: "outCreateursCit", defaultText: "Cr√©ateurs" },
    { inId: "valAnnee", outId: "outAnneeCit", defaultText: "Ann√©e" },
    { inId: "valJourMois", outId: "outJourMoisCit", defaultText: "Ann√©e" },     
    { inId: "titre", outId: "outTitreCit", defaultText: "" },
    { inId: "titre_url", outId: "outLinkCitText", defaultText: "" },    
    { inId: "organ", outId: "outEditCit", defaultText: "" },  
  // Adaptation  
    { inId: "AdaptIn", outId: "AdaptOut", defaultText: "" }
  ],
  3: [null  // on va pointer vers 2 parcqu'identique (2 boutons)
  ],
  4: [
    { inId: "titre", outId: "outTitre", defaultText: "Titre de l'≈ìuvre" },
    { inId: "createurs_tableAuteurs", outId: "outCreateurs", defaultText: "Cr√©ateurs" },
    { inId: "valJourMois", outId: "outJourMois", defaultText: "Jour Mois" },  
    { inId: "valAnnee", outId: "outAnnee", defaultText: "Ann√©e" },
    { inId: "organ", outId: "outEditCit", defaultText: "Organisation √©ditrice" },
// Citation
    { inId: "createursAPA_tableAuteurs", outId: "outCreateursCit", defaultText: "Cr√©ateurs" },
    { inId: "valAnnee", outId: "outAnneeCit", defaultText: "Ann√©e" },
    { inId: "valJourMois", outId: "outJourMoisCit", defaultText: "Ann√©e" },     
    { inId: "titre", outId: "outTitreCit", defaultText: "" },
    { inId: "titre_url", outId: "outLinkCitText", defaultText: "" },    
    { inId: "organ", outId: "outEditCit", defaultText: "" },  

    { inId: "AdjustIn", outId: "AdjustOut", defaultText: "" }
  ]

};

function setHighlight(el, condition) {
  if (!el) return;
  if (condition) {
    el.classList.add("highlight");
  } else {
    el.classList.remove("highlight");
  }
}

const config = {
  titre: {
    sourceId: "titre_url",
    outputs: ["outTitre","outLinkCitText"],
    handler: (val, outEl) => {
      if (!regexURL.test(val)) {
        if (val) {
          alert("Oeuvre : URL non conforme : veuillez corriger.");
          document.getElementById("titre_url").classList.add("highlight");
        }
        return null;
      }
      return { href: val, text: outEl.textContent || val };
    }
  },

  titre0: {
    sourceId: "titre_url0",
    outputs: ["outTitre0"],
    handler: (val, outEl) => {
      if (!regexURL.test(val)) {
        if (val) {
          alert("Oeuvre : URL non conforme : veuillez corriger");
          document.getElementById("titre_url0").classList.add("highlight");
        }
        return null;
      }
      return { href: val, text: outEl.textContent || val };
    }
  },

  profil: {
    sourceId: "createurs_profil",
    outputs: ["outCreateurs"],
    handler: (val, outEl) => {
      if (regexURL.test(val)) return { href: val, text: outEl.textContent || val };
      if (regexEmail.test(val)) return { href: "mailto:" + val, text: outEl.textContent || val };
      if (val) {
        alert("Cr√©ateurs : URL ou adresse courriel non conforme : veuillez corriger");
        document.getElementById("createurs_profil").classList.add("highlight");
      }
      return null;
    }
  },

  profil0: {
    sourceId: "createurs_profil0",
    outputs: ["outCreateurs0"],
    handler: (val, outEl) => {
      if (regexURL.test(val)) return { href: val, text: outEl.textContent || val };
      if (regexEmail.test(val)) return { href: "mailto:" + val, text: outEl.textContent || val };
      if (val) {
        alert("Cr√©ateurs : URL ou adresse courriel non conforme : veuillez corriger");
        document.getElementById("createurs_profil0").classList.add("highlight");
      }
      return null;
    }
  },

  licence: {
    sourceId: "choix_lic",
    outputs: ["outLicenceLink", "outLicenceLinkCit"],
    handler: (val, outEl, sourceEl) => {
      const optionTexte = sourceEl.options[sourceEl.selectedIndex].text;
      if (!val) return { href: "", text: optionTexte };
      return { href: licences[val].url || optionTexte, text: optionTexte };
    }
  },

   licence0: {
    sourceId: "choix_lic0",
    outputs: ["outLicenceLink0"],
    handler: (val, outEl, sourceEl) => {
      const optionTexte = sourceEl.options[sourceEl.selectedIndex].text;
     //alert(optionTexte);
      if (!val) return { href: "", text: optionTexte };
      return { href: licences[val].url || optionTexte, text: optionTexte };
    }
  }
};

function majLien(key) {
  const conf = config[key];
  if (!conf) return;

  const sourceEl = document.getElementById(conf.sourceId);
  if (!sourceEl) return;

  const val = sourceEl.value?.trim() || sourceEl.value || "";
  conf.outputs.forEach(id => {
    const outEl = document.getElementById(id);
    if (!outEl) return;

    const result = conf.handler(val, outEl, sourceEl);
    if (!result) return;

    if (result.href) {
      outEl.innerHTML = `<a href="${result.href}" target="_blank">${result.text}</a>`;
    } else {
      outEl.textContent = result.text;
      outEl.removeAttribute("href");
    }
  });
}

function updateOutput() {//oeuvre 1   
    const z=zone();
    mappings[3] = mappings[2];
    const fields = mappings[z] || [];
    fields.forEach(({ inId, outId, defaultText }) => {
        const encoded = getEncodedValue(inId, defaultText);
        const outEl = document.getElementById(outId);
        if (outEl) outEl.innerHTML = encoded;
  });
      
    majLien("titre");
    majLien("profil");
    majLien("licence");
    // Correction de ponctuation
    AjoutePointEspace("outLinkCitText");
    AjoutePointEspace("outEditCit");
    majLicence();
    AjouteSaufException();
       
    //Affiche boutons  "Copier"
    document.getElementById('btnCopier1').style.display = 'block';
    document.getElementById('btnCopier2').style.display = 'block';
   // updateURLTitreCitation();
}

function updateOutput0() { //oeuvre 0 = source
        majLien("titre0");
        majLien("profil0");
        majLien("licence0");
       // Correction de ponctuation
       AjoutePointEspace("outLinkCitText");
       AjoutePointEspace("outEditCit");        
}


function AjoutePointEspace(id) {
  const el = document.getElementById(id);
  if (el) {
    const contenu = el.innerHTML.trim();
    if (contenu.length > 0) {
      // V√©rifie si √ßa ne finit pas d√©j√† par ". "
      if (!contenu.endsWith(". ")) { // attention : espace ins√©cable
        el.innerHTML = contenu + ".&nbsp;";
      }
    }
  }
}

function AjouteSaufException() {
    const input = document.getElementById("collect");
    const exception = document.getElementById("exception");

    // Affiche ou masque imm√©diatement selon l'√©tat actuel
    exception.style.display = input.checked ? "inline" : "none";
}


 let dernierTab = null;

function openTab(LeTab, btn) {
 dernierTab=LeTab;
  // cacher tous les contenus
 boutonActif = btn; 
  //const LeType = getSelectedType(); //quel type d'oeuvre
 const z= zone();
 if (z===4) {LeTab='tab1'} //on demeure sur l'onglet de l'oeuvre d'origine
  document.querySelectorAll('.tab-content').forEach(div => { 
    div.style.display = 'none';
  });

  // afficher le bon onglet
  document.getElementById(LeTab).style.display = 'block';
 
  // retirer l‚Äôemphase de tous les boutons
  document.querySelectorAll('.tab-buttons button').forEach(b => {
    b.classList.remove('active-tab');

  });

  // ajouter l‚Äôemphase au bouton cliqu√©
 // if (z===4) {btn = document.querySelector('.tab-buttons button[data-tab="tab1"]');}
  btn.classList.add('active-tab');

 AfficheAdjustAdapt();

}

 async function copierDansClipboard(id) {
  const el = document.getElementById(id);
  if (el) {
    let html = el.innerHTML;   // r√©cup√®re tout le HTML interne (avec liens)
    let text = el.textContent; // version brute

// üîß Normalisation : remplacer &nbsp; par un espace simple
    html = html.replace(/&nbsp;/g, " ");
    text = text.replace(/\u00A0/g, " "); // \u00A0 = espace ins√©cable

    try {
      await navigator.clipboard.write([
        new ClipboardItem({
          "text/plain": new Blob([text], { type: "text/plain" }),
          "text/html": new Blob([html], { type: "text/html" })
        })
      ]);
      alert("Bloc copi√© avec ses liens !");
    } catch (err) {
      console.error("Erreur de copie :", err);
    }
  }
}

  </script>

</head>

<!--**************************BODY************************************-->
<body>
 
  <h1>G√©n√©rateur d'attribution et de citation d'une &#339;uvre</h1>

 <div class="bloc-type"> 
<!-- <div style="display: flex; justify-content: space-between; align-items: center;"></div>    
  -->  
 <div style="margin-top: 10px; font-size: 1.2rem; font-weight: bold;">
    <strong>Type&nbsp;:</strong>
</div>

<div class="radio-group">
    <label>
       <input type="radio" name="type" value="1" id="f1">
          Originale
    </label>

    <label>
      <input type="radio" name="type" value="2" id="f2">
      Adapt√©e (d√©riv√©e)
    </label>
    
    <label>
      <input type="radio" name="type" value="4" id="f4">
      Ajust√©e (l√©g√®rement modifi√©e)
    </label>
</div>

<script>
  // Associe chaque valeur √† la fonction correspondante
const fonctions = {
    1: fonctionOriginale,
    2: fonctionAdaptee,
    4: fonctionAjustee
};

// Quand on clique sur un bouton radio ‚Üí mettre f=1,2,4 dans l‚ÄôURL
document.querySelectorAll('input[name="type"]').forEach(radio => {
    radio.addEventListener("change", () => {
        const url = new URL(window.location.href);
        url.searchParams.set("f", radio.value);
        window.location.href = url.toString();
    });
});

// Au chargement ‚Üí lire f=1,2,4
window.addEventListener("DOMContentLoaded", () => {
    const params = new URLSearchParams(window.location.search);
    let f = params.get("f");

    // Si aucun param√®tre ‚Üí f=1 par d√©faut
    if (!f || !fonctions[f]) {
        f = "1";
    }

    // Coche le bon bouton
    const radio = document.querySelector(`input[name="type"][value="${f}"]`);
    if (radio) radio.checked = true;

    // Ex√©cute la fonction correspondante
    fonctions[f]();
});

</script>


   <!-- <div class="explication" id="Explications">Bienvenue. Ce g√©n√©rateur vous permettra de cr√©er une attribution Creative Commons conforme pour votre oeubre ainsi qu'une citation APA.</div> -->
     <div class="explication" id="Explications"></div>
</div>

<!--  2 BOUTONS VERS ONGLETS-->
<div style="display: flex; justify-content: space-between; align-items: center;">
 <div class="tab-buttons" id="boutons">
      <button id="btn1" data-tab="tab1" onclick="openTab('tab1', this)">Infos sur votre oeuvre</button>
      <button id="btn2" data-tab="tab2" onclick="openTab('tab2', this)">Infos sur l'oeuvre d'origine</button>
    </div>

<span class="quote" id="remplir" >Remplir les champs du formulaire pour g&#233;n&#233;rer un libell&#233; d'attribution CC conforme.
</span>
<span class="droite" id="generer">
<button class="bouton-grand" id="btn_generer"  onclick="AfficherAttribCit()";>G√©n√©rer</button>
</span>
</div>
<!--**************************BODY************************************-->
<div class="container">
    <div class="col1">
        <div class="tabs">
        <!-- Colonne 1, TAB1 : SAISIE Oeuvre 1--> 
            <div id="tab1" class="tab-content">
                <div class="panel">
                <h2>Informations de saisie</h2>
<!-- size="200" -->
                <label for="titre">*Titre de l'&#339;uvre <span id="dorigineTitre" class="hidden"> (d'origine)</span></label>
                <input type="text" id="titre" placeholder="Ex. : ma Super ressource">

                <label for="titre_url" class="decale" >Lien vers l'&#339;uvre</label>
                <input type="url" id="titre_url" class="decale" placeholder="Ex. : https://www.enseigner.ulaval.ca/pedagogie/bonnes-pratiques-denseignement">

                <label for="createurs">*Identification des autrices et auteurs <span id="dorigineAuteurs" class="hidden"> (d'origine)</span></label></label>


<!-- ***************************************** -->
<!-- <h2>Table Auteurs 1</h2> -->
<table id="tableAuteurs" class="table-auteurs">
  <thead>
    <tr>
      <th>Nom(s)</th>
      <th>Pr√©nom(s)</th>
      <th title="Cocher s'il s'agit d'une organisation">Organisation</th>
      <th title="Clic sur + pour ajouter une ligne.&#10;Pour trier plusieurs lignes, glisser-d√©poser." class="tooltip-trigger">?</th>
<div id="tooltip" class="tooltip">
  Clic sur + pour ajouter une ligne.<br>
  Pour trier plusieurs lignes, glisser-d√©poser.
</div>

    </tr>
  </thead>
  <tbody>
    <tr>
      <td><input id="tabAuteursL1" type="text" placeholder="Ex. : Dupont"></td>
      <td><input type="text" placeholder="Ex. : Josette"></td>
      <td><input type="checkbox"></td>
      <td class="add-row"><strong>+</strong></td>
    </tr>
  </tbody>
</table>

<!-- Sorties g√©n√©r√©es automatiquement mais cach√©es-->
 <div class="cache">
  <label>Cr√©ateurs :</label><br>
<input type="text" id="createurs_tableAuteurs" style="width:400px"><br><br>

<label>Sortie APA :</label><br>
<input type="text" id="createursAPA_tableAuteurs" style="width:400px"><br><br> 
</div>


<!-- ************************************** -->

                <label for="createurs_profil" class="decale">URL ou adresse courriel de contact</label>
                <input type="text" id="createurs_profil" class="decale" Ex. : placeholder="Ex. : https://sse.ulaval.ca ou sse@ulaval.ca">
<p></p>              
             <div class="form-flex"> 
                <div>
                    <h2>*Licence Creative Commons :</h2>
                    <!-- <label for="choix_lic">Menu dÔøΩroulant :</label>--> 
                    <select id="choix_lic" >
                    <option value="">-- S&eacute;lectionnez --</option>
                    <option value="1">CC0 1.0 (Domaine public)</option>
                    <option value="2" selected>CC BY 4.0</option>
                    <option value="3" >CC BY-SA 4.0</option>
                    <option value="4">CC BY-NC 4.0</option>
                    <option value="5">CC BY-NC-SA 4.0</option>
                    <option value="6">CC BY-ND 4.0</option>
                    <option value="7">CC BY-NC-ND 4.0</option>
                    </select>
                </div>        
                <!-- <div>        
                    <label for="annee">*Ann&eacute;e de cr&eacute;ation</label>
                    <input type="number" id="annee"  max="2050" min="1960" placeholder="Ex. : 2025">

                </div>  -->

        <div class="container_cal">
            <label for="dateEvenement">*Date de cr√©ation :</label>
            <input type="text" id="dateEvenement" aria-describedby="dateHint" placeholder="S√©lectionner une date">
            <!-- Case √† cocher Jour --> 
              <div class="jour-wrapper">
              <!-- <label for="chkJour">Affiche jour<input type="checkbox" id="chkJour" checked></label> -->
                <label for="chkJour" id="blocJour">
                  <span class="label-jour-texte">Affiche le jour</span>
                  <input type="checkbox" id="chkJour" checked>
                </label>
            </div>

            <!-- <p id="dateHint">S√©lectionnez une date dans le calendrier.</p>

            <button onclick="afficherDate()">Convertir la date</button> -->

            <p id="resultat" aria-live="polite" class="hidden">
                <!-- <span id="valJour"></span>
                <span id="valMoisLet"></span> -->
                <span id="valJourMois"></span>
                <span id="valAnnee"></span>
            </p>       
        </div>

        <div class="">
              <label for="collect" id="blocJour">
                <span>Collection</span>
                <input type="checkbox" id="collect" unchecked>
                <br><span class="soustexte">Si l'oeuvre contient<br>des exceptions, affiche <br>"sauf indications contraires"</span>
              </label>
          </div>

  <script>
    const urlND = "https://fabriquerel.org/wp-content/uploads/CC-BY_fabriqueREL2.pdf";
    const urlCC = "https://www.donneesquebec.ca/foire-aux-questions/#cco";

    const z = zone(); // ta fonction existante
//alert(z);
    // Fonction qui retourne le bon message selon la licence et z
    function getMessageLicence(val, z) {

        if (val === 1) {
            return {
                msg: `Rappel : Avec la licence <strong>CC0</strong>, il n'y a pas d'obligation de vous citer puisque l‚Äô≈ìuvre est du domaine public.<br><br>Voir <a href="${urlCC}" target="_blank">cette page</a>.`,
                type: "warn"
            };
        }

        if (val === 6) {
            if (z === "1") {
                return {
                    msg: `Rappel : La licence <strong>CC BY-ND</strong> n'est pas une <strong>licence libre</strong> car elle ne permet pas la modification (ND = NoDerivatives).<br><br>Voir <a href="${urlND}" target="_blank">cette page</a>.`,
                    type: "warn"
                };
            }
            if (z === "4") {
                return {
                    msg: `La licence de l‚Äô≈ìuvre d'origine <strong>CC BY-ND</strong> ne permet <strong>aucune modification, m√™me mineure</strong> (ND = NoDerivatives).<br><br>Voir <a href="${urlND}" target="_blank">cette page</a>.`,
                    type: "err"
                };
            }
        }

        if (val === 7) {
            if (z === "1") {
                return {
                    msg: `Rappel : La licence <strong>CC BY-NC-ND</strong> n'est pas une <strong>licence libre</strong> car elle ne permet pas la modification (ND = NoDerivatives).<br><br>Voir <a href="${urlND}" target="_blank">cette page</a>.`,
                    type: "warn"
                };
            }
            if (z === "4") {
              //alert("4");
                return {
                    msg: `La licence de l‚Äô≈ìuvre d'origine <strong>CC BY-NC-ND</strong> ne permet <strong>aucune modification, m√™me mineure</strong> (ND = NoDerivatives).<br><br>Voir <a href="${urlND}" target="_blank">cette page</a>.`,
                    type: "err"
                };
            }
        }

        return null; // aucun message
    }

    // √âcouteur sur le menu d√©roulant
    document.getElementById("choix_lic").addEventListener("change", function () {
        const val = Number(this.value);
       // alert(val);
        const res = getMessageLicence(val, z);

        if (res) {
            AfficherCheckRes(res);
            if (z === "4" && res.type === "err") {
                resetSelect("choix_lic");
            }
        }
    });
</script>



<script>
function resetSelect(id) {
    const sel = document.getElementById(id);
    if (sel) {
        sel.value = "";
    }
}
</script>


    <script> //date du jour par d√©faut
window.addEventListener("DOMContentLoaded", () => {
    const input = document.getElementById("dateEvenement");

    // R√©cup√®re la date du jour au format AAAA-MM-JJ
    const today = new Date().toISOString().slice(0, 10);

    // Ins√®re la date compl√®te dans le champ
    input.value = today;
});
</script>
          

<script>
document.getElementById("chkJour").addEventListener("change", function () {
    const input = document.getElementById("dateEvenement");
    if (!this.checked) {
        input.value = input.value.substring(0, 7);
        document.getElementById("blocJour").style.display = "none";
    }
});

document.getElementById("dateEvenement").addEventListener("change", function () {
        document.getElementById("blocJour").style.display = "flex";
        document.getElementById("chkJour").checked = true;
  });
</script>
                

            </div> 
                <label for="organ">Organisation √©ditrice (si pas dans les auteurs)</label>
                <input type="text" id="organ" placeholder="Ex. : C√©gep ABC / Universit√© XYZ / ">
<p></p>
            <div class="bloc-type2" id="blocAdjustIn">
            <label for="AdjustLabel">*Ajustements effectu√©s</label>
            <input type="text" id="AdjustIn" placeholder="Ex. : Quelques mots chang√©s, fautes corrig√©es, changement de couleur, etc.">
        </div>

        <!-- <div class="bloc-type" id="blocAdaptIn">
            <label for="AdaptLabel">Adaptations effectu√©es : </label>
            <input type="text" id="AdaptIn" placeholder="Ajout d'une section compl√®te, changement de format, traduction, etc.">
        </div> -->

                    <!--    <p class="help">Saisissez normalement (ÔøΩ, ÔøΩ, ÔøΩ, ÔøΩ). La sortie encode les caractÔøΩres en entitÔøΩs HTML.</p>-->
            </div><!--panel-->



        </div> <!--tab1-->
    </div><!--tabs-->

        <!--**************************BODY************************************-->
            <!-- Colonne 1, TAB2 : SAISIE Oeuvre 0 SOURCE (s'il y a lieu)--> 
            <div id="tab2" class="tab-content" style="display:none;">
                <div class="panel">
                <h2>Informations de saisie</h2>

                <label for="titre">*Titre de l'&#339;uvre</label>
                <input type="text" id="titre0" placeholder="Ex.: ma Super ressource">

                  <label for="titre_url0" class="decale" >Lien vers l'&#339;uvre</label>
                <input type="url" id="titre_url0" class="decale" placeholder="Ex. https://www.enseigner.ulaval.ca/pedagogie/bonnes-pratiques-denseignement">

<!-- ****************************************** -->
<!-- <h2>Table Auteurs 2</h2> -->
 <label for="createurs">*Identification des autrices et auteurs</label>
<table id="tableAuteurs0" class="table-auteurs">
  <thead>
    <tr>
      <th>Nom(s)</th>
      <th>Pr√©nom(s)</th>
      <th>Organisation</th>
      <th title="Clic sur + pour ajouter une ligne.&#10;Pour trier plusieurs lignes, glisser-d√©poser.">?</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><input id="tabAuteurs0L1" type="text" placeholder="Ex. Tremblay"></td>
      <td><input type="text" placeholder="Ex. Marc"></td>
      <td><input type="checkbox"></td>
      <td class="add-row"><strong>+</strong></td>
    </tr>
  </tbody>
</table>

<!-- Sorties g√©n√©r√©es automatiquement mais cach√©es-->
 <div class="cache">
<label>Cr√©ateurs :</label><br>
<input type="text" id="createurs_tableAuteurs0" style="width:400px"><br><br>

<label>Sortie APA :</label><br>
<input type="text" id="createursAPA_tableAuteurs0" style="width:400px"><br><br> 
</div>

<!-- ************************************** -->

                <!-- <label for="createurs">*Nom complet des cr&eacute;ateurs (reprendre le nom inscrit sur l'oeuvre)</label>
                <input type="text" id="createurs0" placeholder="Ex. Marie Tremblay"> -->

                <label for="createurs_profil" class="decale">URL ou adresse courriel de contact</label>
                <input type="text" id="createurs_profil0" class="decale" Ex. : Ex. : placeholder="https://sse.ulaval.ca ou sse@ulaval.ca">
<p></p>              
             <div class="form-flex"> 
                <div>
                    <h2>*Licence Creative Commons :</h2>
                    <!-- <label for="choix_lic">Menu dÔøΩroulant :</label>--> 
                    <select id="choix_lic0" >
                    <option value="">-- S&eacute;lectionnez --</option>
                    <option value="1">CC0 1.0 (Domaine public)</option>
                    <option value="2" selected>CC BY 4.0</option>
                    <option value="3" >CC BY-SA 4.0</option>
                    <option value="4">CC BY-NC 4.0</option>
                    <option value="5">CC BY-NC-SA 4.0</option>
                    <option value="6">CC BY-ND 4.0</option>
                    <option value="7">CC BY-NC-ND 4.0</option>
                    </select>
                </div>        
                <div>        
                    <label for="annee0">*Ann&eacute;e de cr&eacute;ation</label>
                    <input type="number" id="annee0"  max="2050" min="1960" placeholder="Ex. : 2025">

                </div> 

                <script>
                    window.addEventListener("DOMContentLoaded", () => {
                    const anneeInput = document.getElementById("annee0");
                    const currentYear = new Date().getFullYear();
                    anneeInput.value = currentYear;
                });
                </script>
         
            </div> 
                <label for="organ0">Organisation √©ditrice (si pas dans les auteurs)</label>
                <input type="text" id="organ0" placeholder="Universit√© Laval">
<p></p>
        <div class="bloc-type2" id="blocAdaptIn">
            <label for="AdaptLabel">*Adaptations effectu√©es : </label>
            <input type="text" id="AdaptIn" placeholder="Ex. : Ajout d'une section compl√®te, changement de format, traduction, etc.">
        </div>
        </div> <!--fin class="panel"-->

            </div><!--fin class="tab2"-->

    </div> <!--fin class="col1"-->

            

        <!--  ********************************************************** -->
        <!-- Colonne 2 : SORTIE -->
    <div class="col2"> 
        <div class="title-out" id="AttribOutTitre">ATTRIBUTION RECOMMAND&Eacute;E<p></p>
        </div>
        
        <div class ="" id="Attributions" >
            <span id="Attrib1">

<table class="cc-table">
  <tr>
    <td class="cell-icon"> <div id="bloc_cc"><a id="cc_link" href="https://creativecommons.org/licenses/by/4.0/deed.fr" target="_blank" rel="noopener">
            <span >
                <img id="cc_img" class="cc-50" src="https://mirrors.creativecommons.org/presskit/buttons/88x31/png/by.png"
                    alt="Licence Creative Commons BY">
            </span>
            </a></div>
        </td>
    <td class="cell-text">
        <span id="outLine" class="out-line" > 

                
                &laquo;
                <span id="outTitre" class="quote">Titre de l'&#339;uvre</span>
                &raquo;,&nbsp;
               <span id="copysymb">&copy;</span><span id="par" class="hidden">par</span>  
                <span id="outCreateurs" class="quote">Cr√©ateurs</span><span id="virgEsp">,&nbsp;</span>
                <span id="outAnnee">An</span>&nbsp;(<span id="outJourMois">Jour Mois</span>), est sous licence
                    <a id="outLicenceLink"> <span id="outLicenseText" class="quote">&laquo; Licence √† choisir &raquo;</span></a><span id="exception" class="out-line">,&nbsp;sauf indications contraires</span>.
                </span>
            </span><!-- Attrib1 -->

            <span id="AdapTransit" class="quote"> / Adapt√© de : </span>
            <span id="Attrib2">
            <!-- ATTRIBUTION OEUVRE SOURCE -->
                &laquo;
                <span id="outTitre0" class="quote">Titre de l&#339;uvre</span>
                    &raquo;,&nbsp;
                    &copy; &nbsp;
                    
                    <span id="outCreateurs0" class="quote">Cr√©ateurs</span>,&nbsp;
                    <span id="outAnnee0">An</span>,
                    <!-- <span id="est">&nbsp;est&nbsp;</span> -->
                    sous licence&nbsp;
                        <a id="outLicenceLink0"> <span id="outLicenseText0" class="quote">&laquo; Licence √† choisir &raquo;</span></a>. 
            </span>

            <span id="Attrib3"><span id="AdjustOutPrez" class="quote"><br> / <strong>Ajustements effectu√©s : </strong><span id="AdjustOut" class="quote"></span></span></span>
            <span id="Attrib4"><span id="AdaptOutPrez" class="quote"><br> / <strong>Adaptations effectu√©es : </strong><span id="AdaptOut" class="quote"></span></span></span>
            <!-- <span id="Attrib3"><br> / <strong>Ajustementss effectu√©es : </strong><span id="AdjustOut" class="quote">test    </span></span> -->
    </td>
  </tr>
</table>



                
        </div> 
        <!-- <br> -->
<div class="adroite">
<button id="btnCopier1" class="bouton-moyen" onclick="copierDansClipboard('Attributions')";>Copier</button>
</div>
   <!--  ********************************************************** -->
    <!--*********************       APA      ***********************-->
   <div id="CitBloc">
    
        <span class="title-out" id="CitBlocTitre"><p><br></p> Comment citer cette oeuvre en style APA&nbsp;:<p></p></span>
    <table class="cc-table">
  <tr>
    <td>
            <span id="outCreateursCit" class="quote">Cr√©ateurs</span>&nbsp;
            (<span id="outAnneeCit">An</span>,&nbsp;<span id="outJourMoisCit">Jour Mois</span>).&nbsp;     
            <span id="outTitreCit" class="quote">Titre de l'&#339;uvre</span>.&nbsp;
            <span id="outEditCit" class="quote">Organisation √©ditrice.</span>
            <!-- .&nbsp;             -->
        <a id="outLinkCit"> <span id="outLinkCitText" class="quote">DOI ou URL.</span></a>
        <!-- .&nbsp;  -->
        Sous licence&nbsp;<a id="outLicenceLinkCit"> <span id="outLicenseTextCit" class="quote">&laquo; Licence √† choisir &raquo;</span></a>.
       
          </td>
  </tr>
    </table>
    </div>


<!-- <br> -->
<div class="adroite">
<button class="bouton-moyen" id="btnCopier2" onclick="copierDansClipboard('CitBloc')";>Copier</button>
</div>


<p></p><p></p>
<div style="margin-top: 300px;"></div>
<div class="bloc-typeRef">
  <div class="headerRef">
    <div class="title-out">R√©f√©rences et compl√©ments</div>
    <button id="toggleRef" class="toggle-btnRef">+</button>
  </div>

  <div id="ref" class="content" style="display:none;">
    <ul>
      <li><a href="https://wiki.creativecommons.org/wiki/Recommended_practices_for_attribution" target="_blank">Recommended practices for attribution (Creative Commons)</a></li>    
      <li><a href="https://www.uottawa.ca/bibliotheque/droit-auteur/quest-ce-que-droit-auteur/comment-attribuer-du-contenu-license-creative-commons-pratiques-exemplaires" target="_blank">Comment attribuer du contenu sous license CC (U. Ottawa)</a></li>
      <li><a href="https://www.bda.ulaval.ca/utilisation-libre/oeuvres-sous-licence-creative-commons/" target="_blank">Oeuvres sous licence CC (U. Laval)</a></li>
      <li><a href="https://fabriquerel.org/ressources/licences/" target="_blank">Les licences (fabriqueREL)</a></li>
      <li><a href="https://creativecommons.org/chooser/" target="_blank">Licence Chooser (Creative Commons)</a></li>
      <li><a href="https://creativecommons.org/mission/downloads/" target="_blank">CC icons (Creative Commons)</a></li>
      <li><a href="https://creativecommons.org/faq/#if-i-derive-or-adapt-material-offered-under-a-creative-commons-license-which-cc-licenses-can-i-use:~:text=the%20next%20FAQ.)-,Adapter%E2%80%99s%20license%20chart,-The%20chart%20below" target="_blank">Conformit√© des licences CC d'oeuvres adapt√©es (Creative Commons)</a></li>
    </ul>
  </div>
</div>


<div><!-- Bouton discret -->
<button id="aproposBtn" class="apropos-btn">√Ä propos</button>

<!-- Licence GNU GPLv3 - Fen√™tre modale cach√©e au d√©part  -->
<div id="aproposModal" class="modal">
  <div class="modal-content">
    <span id="closeModal" class="close">&times;</span>
    <h2>Licence GNU GPLv3</h2>
    <pre>
Copyright (C) 2026 Claude Potvin (https://www.linkedin.com/in/claude-potvin-b506a471/)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program. If not, see &lt;https://www.gnu.org/licenses/&gt;.


Note pour les francophones : 
Pour des raisons l√©gales, cette licence n'est pour le moment disponible
qu'en anglais.
    </pre>
  </div>
</div>

</div>

</div> <!-- col2-->

<!-- ************************************************************ -->


  <script>
//ouvre √âtape 1 par d√©faut : Originale / Tab1
const btn = document.querySelector('.tab-buttons button[data-tab="tab1"]'); // quel tab?

fonctionOriginale();

function updateURLTitreCitation() {

    const optionTexte = document.getElementById('titre');
  //  const outLinkCit = document.getElementById('outLinkCit'); // RÔøΩcupÔøΩre le libellÔøΩ       
    //if  (LeType === "originale" || boutonActif.id === "tab2"){
    //    if (LeType !== "ajustee" && boutonActif.id === "btn2"){          
        outLinkCit.textContent = optionTexte;
        if (valeur0) {
            outLinkCit.href = licences[valeur0].url || "";
        //alert(url);// rend le titre cliquable
            outLinkCit.target = "_blank";
            outLinkCit.rel = "noopener noreferrer";
        } else {
            outLinkCit.removeAttribute('href');  // pas de lien si URL vide
        }

   const urlTitre = document.getElementById('titre_url').value.trim();
       let lienT = "";   
      if (regexURL.test(urlTitre)) {
        // Priorit√© √† l‚ÄôURL
        lienT=urlTitre;
      } 
      else {
        if (urlTitre) alert("Oeuvre : URL non conforme");
        return;
      }
      const outLinkCit = document.getElementById('outLinkCit'); // RÔøΩcupÔøΩre le libellÔøΩ 
      outLinkCit.innerHTML = `<a href="${lienT}" target="_blank">${urlTitre}</a>`;
      
      //activation URL citation APA
     // const outLinkCit = document.getElementById('outLinkCit'); // RÔøΩcupÔøΩre le libellÔøΩ       
    //    if  (getSelectedType() !== "ajustee"){
       // if  (zone() === 1) {
     outLinkCit.innerHTML = `<a href="${lienT}" target="_blank">${lienT}</a>`;


}    

function hideSpan(id) {
    const el = document.getElementById(id);
    if (el) el.classList.add("hidden");
}

function showSpan(id) {
    const el = document.getElementById(id);
    if (el) el.classList.remove("hidden");
}

 

//Toggle Ref
document.getElementById("toggleRef").addEventListener("click", function() {
  const ref = document.getElementById("ref");
  if (ref.style.display === "none" || ref.style.display === "") {
    ref.style.display = "block";
    this.textContent = "‚Äì"; // change le + en ‚Äì
  } else {
    ref.style.display = "none";
    this.textContent = "+"; // remet le +
  }
});

// BOUTON √Ä PROPOS LICENCE GNU GPLv3

const modal = document.getElementById("aproposModal");
const btnAP = document.getElementById("aproposBtn");
const close = document.getElementById("closeModal");

btnAP.addEventListener("click", () => {
  modal.style.display = "block";
});
close.addEventListener("click", () => {
  modal.style.display = "none";
});
window.addEventListener("click", (event) => {
  if (event.target === modal) {
    modal.style.display = "none";
  }
});


//Aide tableau des auteurs
const trigger = document.querySelector('.tooltip-trigger');
const tooltip = document.getElementById('tooltip');

trigger.addEventListener('click', (e) => {
  const rect = trigger.getBoundingClientRect();
  tooltip.style.left = rect.left + 'px';
  tooltip.style.top = rect.bottom + 'px';
  tooltip.style.display = tooltip.style.display === 'block' ? 'none' : 'block';
});

document.addEventListener('click', (e) => {
  if (!trigger.contains(e.target) && !tooltip.contains(e.target)) {
    tooltip.style.display = 'none';
  }
});


function majLicence() {
    const select = document.getElementById("choix_lic");
    const value = select.value;

 // Si PD, cache le symcole CC et le nom de l'auteur 
  if (value==="1"){
    //alert("etest");
     hideSpan("copysymb");
     showSpan("par");// remplace symb copyright
    // hideSpan("outCreateurs");
    // hideSpan("virgEsp");
  }
  else {
     showSpan("copysymb");
     hideSpan("par");     
    // showSpan("outCreateurs");
    // showSpan("virgEsp");
  }

    const link = document.getElementById("cc_link");
    const img = document.getElementById("cc_img");

    if (!value || !licences[value]) {
        link.href = "#";
        img.src = "";
        img.alt = "";
        return;
    }

    const { url, icon } = licences[value];

    link.href = url;
    img.src = icon;
    img.alt = `Licence Creative Commons ${select.options[select.selectedIndex].text}`;
}


</script>

 <!-- Flatpickr JS -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/fr.js"></script>

  <script>
    // Initialisation du calendrier en fran√ßais
    flatpickr("#dateEvenement", {
      dateFormat: "Y-m-d",
      locale: "fr"
    });

function convertirDate() {
  const input = document.getElementById("dateEvenement");

  if (!input.value) {
    return null;
  }

  // const [anneeC, mois, jour] = input.value.split("-");
  const parts = input.value.split("-"); // ["2026", "02"] ou ["2026", "02", "18"] 
  const anneeC = parts[0]; 
  const mois = parts[1]; 
  const jour = parts.length === 3 ? parts[2] : ""; // ‚Üê ici la magie

  const moisEnLettres = [
    "janvier", "f√©vrier", "mars", "avril", "mai", "juin",
    "juillet", "ao√ªt", "septembre", "octobre", "novembre", "d√©cembre"
  ][parseInt(mois, 10) - 1];

  return { jour, moisEnLettres, anneeC };
}

function afficherDate() {
  const resultat = convertirDate();

  if (!resultat) {
    //document.getElementById("resultat").textContent = "Veuillez choisir une date.";
    return;
  }

//   document.getElementById("valJour").value = resultat.jour + " ";
//   document.getElementById("valMoisLet").value = resultat.moisEnLettres + " ";
 document.getElementById("valJourMois").value = enleverZeroJour(resultat.jour) + " " + resultat.moisEnLettres; 
  document.getElementById("valAnnee").value = resultat.anneeC;
   //document.getElementById("annee").value = resultat.anneeC;
}

function enleverZeroJour(jour) {
    return jour ? jour.replace(/^0/, "") : "";
}

  </script>



</script>

<!-- *******************BOITE DE SAISIE DYNAMIQUE POUR LES AUTEURS********************************************** -->

<!-- Import SortableJS -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

<script>
// ------------------------------------------------------------
// Met √† jour les sorties pour une table donn√©e
// ------------------------------------------------------------
function majSorties(tableId) {
  const table = document.getElementById(tableId);
  const rows = table.querySelectorAll("tbody tr");

  let createursItems = [];
  let createursAPAItems = [];

  rows.forEach(row => {
    const nom = row.cells[0].querySelector("input").value.trim();
    const prenomInput = row.cells[1].querySelector("input");
    const prenom = prenomInput.value.trim();
    const orgChecked = row.cells[2].querySelector("input[type=checkbox]").checked;

    if (orgChecked && nom) {
      createursItems.push(nom);
      createursAPAItems.push(nom);
    } else if (nom) {
      if (prenom) {
        createursItems.push(`${prenom} ${nom}`);

        const parties = prenom.split(/\s+/);
        const initiales = parties.map(p =>
          p.includes("-")
            ? p.split("-").map(sub => sub.charAt(0).toUpperCase() + ".").join("-")
            : p.charAt(0).toUpperCase() + "."
        ).join(" ");

        createursAPAItems.push(`${nom}, ${initiales}`);
      } else {
        createursItems.push(nom);
        createursAPAItems.push(nom);
      }
    }
  });

  function formatListe(items) {
    if (items.length === 0) return "";
    if (items.length === 1) return items[0];
    return items.slice(0, -1).join(", ") + " et " + items[items.length - 1];
  }

  document.getElementById("createurs_" + tableId).value = formatListe(createursItems);
  document.getElementById("createursAPA_" + tableId).value = formatListe(createursAPAItems);
}

// ------------------------------------------------------------
// Ajoute une ligne dans une table donn√©e
// ------------------------------------------------------------
function ajouterLigne(tableId) {
  const table = document.getElementById(tableId);
  const tbody = table.querySelector("tbody");
  const rows = Array.from(tbody.querySelectorAll("tr"));

  rows.forEach(row => row.cells[0].querySelector("input").classList.remove("highlight"));

  // Validation : NOM obligatoire (Pr√©nom facultatif)
  for (let row of rows) {
    const nomInput = row.cells[0].querySelector("input");
    const nom = nomInput.value.trim();
    const orgChecked = row.cells[2].querySelector("input[type=checkbox]").checked;

    if (!nom && !orgChecked) {
      nomInput.classList.add("highlight");
      return;
    }
    if (orgChecked && !nom) {
      nomInput.classList.add("highlight");
      return;
    }
  }

  // Supprime le + visuel de la derni√®re ligne
  const lastRow = tbody.lastElementChild;
  if (lastRow) {
    const lastAddCell = lastRow.querySelector(".add-row");
    if (lastAddCell) lastAddCell.textContent = "";
  }

  //********************************************************
  const newRow = document.createElement("tr");
  newRow.classList.add("fade-in");
  newRow.innerHTML = `
    <td><input type="text"></td>
    <td><input type="text"></td>
    <td><input type="checkbox"></td>
    <td class="add-row">+</td>
  `;
  tbody.appendChild(newRow);

  newRow.querySelectorAll("input").forEach(input => {
    input.addEventListener("input", () => majSorties(tableId));
    input.addEventListener("click", () => majSorties(tableId));
    input.addEventListener("input", () => input.classList.remove("highlight"));
  });

  const checkbox = newRow.querySelector("input[type=checkbox]");
  const prenomInput = newRow.cells[1].querySelector("input");
  checkbox.addEventListener("change", e => {
    if (e.target.checked) {
      prenomInput.value = "";
      prenomInput.disabled = true;
      prenomInput.classList.add("disabled");
    } else {
      prenomInput.disabled = false;
      prenomInput.classList.remove("disabled");
    }
    majSorties(tableId);
  });

  repositionnerPlus(tableId);
  majSorties(tableId);
}

// ------------------------------------------------------------
// Replace le + sur la derni√®re ligne (visuel seulement)
// ------------------------------------------------------------
function repositionnerPlus(tableId) {
  const table = document.getElementById(tableId);
  const tbody = table.querySelector("tbody");
  const rows = Array.from(tbody.querySelectorAll("tr"));

  rows.forEach(row => {
    const addCell = row.querySelector(".add-row");
    if (addCell) addCell.textContent = "";
  });

  const lastRow = tbody.lastElementChild;
  if (lastRow) {
    const addCell = lastRow.querySelector(".add-row");
    if (addCell) addCell.textContent = "+";
  }
}

// ------------------------------------------------------------
// Initialise une table
// ------------------------------------------------------------
function initTable(tableId) {
  const table = document.getElementById(tableId);
  const tbody = table.querySelector("tbody");

  table.querySelectorAll("input").forEach(input => {
    input.addEventListener("input", () => majSorties(tableId));
    input.addEventListener("click", () => majSorties(tableId));
    input.addEventListener("input", () => input.classList.remove("highlight"));
  });

  table.querySelectorAll("input[type=checkbox]").forEach(checkbox => {
    const row = checkbox.closest("tr");
    const prenomInput = row.cells[1].querySelector("input");
    checkbox.addEventListener("change", e => {
      if (e.target.checked) {
        prenomInput.value = "";
        prenomInput.disabled = true;
        prenomInput.classList.add("disabled");
      } else {
        prenomInput.disabled = false;
        prenomInput.classList.remove("disabled");
      }
      majSorties(tableId);
    });
  });

  // üîπ Event delegation: on ne r√©agit que si le + est visible
  tbody.addEventListener("click", e => {
    const cell = e.target.closest(".add-row");
    if (!cell) return;
    if (!cell.textContent.includes("+")) return; // pas de + ‚Üí ne rien faire
    ajouterLigne(tableId);
  });

  new Sortable(tbody, {
    animation: 150,
    onEnd: () => {
      majSorties(tableId);
      repositionnerPlus(tableId);
    }
  });

  repositionnerPlus(tableId);
  majSorties(tableId);
}

// ------------------------------------------------------------
// Initialisation automatique de toutes les tables
// ------------------------------------------------------------
document.querySelectorAll(".table-auteurs").forEach(table => {
  initTable(table.id);
});
</script>




    </div>
    
</div><!--CONTAINER-->

  
</body>
</html>
